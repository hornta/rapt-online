var l=true,o=null,p=false;function K(){return function(){}}function L(v){return function(){return this[v]}}function N(v){return function(){return v}}
(function(){function v(a,b){var c,d,e;this.m=new g(Math.min(a.x,b.x),Math.min(a.y,b.y));this.size=(c=new g(Math.max(a.x,b.x),Math.max(a.y,b.y)),d=this.m,e=new g(0,0),e.x=c.x-d.x,e.y=c.y-d.y,e)}function E(a,b){this.f=a;this.h=b}function r(){}function pb(a,b,c){this.Ba=c;this.Se=a;this.q=b}function qb(){this.od();this.ic=[0,0,0,0]}function F(){arguments=Array.prototype.slice.call(arguments);this.f=arguments.shift();this.v=arguments;this.Na=[];for(var a=0;a<this.v.length;a++)this.Na.push(new M(this.v[a],
this.v[(a+1)%this.v.length]));this.Sb=new v(this.v[0],this.v[0]);this.Vc()}function M(a,b){var c,d,e,f,h;this.start=a;this.end=b;this.q=(c=(e=(h=new g(0,0),h.x=b.x-a.x,h.y=b.y-a.y,h),f=e.x,e.x=e.y,e.y=-f,e),d=Math.sqrt(c.x*c.x+c.y*c.y),c.x/=d,c.y/=d,c)}function G(){this.b=new g(0,0);this.l=p}function ma(a,b){return typeof b!=="undefined"?a+(b-a)*Math.random():a}function rb(a,b,c,d){return"rgba("+Math.round(a*255)+", "+Math.round(b*255)+", "+Math.round(c*255)+", "+d+")"}function C(){}function Mb(a){a=
"background-cache-"+a;this.canvas=document.getElementById(a);if(this.canvas===o){this.canvas=document.createElement("canvas");this.canvas.id=a;this.canvas.style.display="none";document.body.appendChild(this.canvas)}this.ia=this.canvas.getContext("2d");this.jc=this.height=this.width=this.Ob=this.Nb=this.vb=this.ub=0;this.Wa=-1}function qc(a,b,c,d){this.i=a;this.r=b;this.width=c;this.height=d;if(rc){this.Rb=new Mb("a");this.vc=new Mb("b")}else this.vc=this.Rb=o}function sc(a,b,c,d){var e=c/d.y,f=b/
d.x;a.beginPath();-b*d.y- -c*d.x>=0&&a.lineTo(-b,-c);Math.abs(d.y*f)<=c&&a.lineTo(-d.x*f,-d.y*f);-b*d.y-+c*d.x>=0&&a.lineTo(-b,+c);Math.abs(d.x*e)<=b&&a.lineTo(d.x*e,d.y*e);+b*d.y-+c*d.x>=0&&a.lineTo(+b,+c);Math.abs(d.y*f)<=c&&a.lineTo(d.x*f,d.y*f);+b*d.y- -c*d.x>=0&&a.lineTo(+b,-c);Math.abs(d.x*e)<=b&&a.lineTo(-d.x*e,-d.y*e);a.closePath();a.clip()}function Nb(a){this.Gc=username;this.O=[];if(this.Gc!==o){var b=this;$.ajax({url:"/stats/",type:"GET",cache:p,dataType:"json",success:function(c){b.O=
c;a()}})}else{this.O=JSON.parse(Yc("rapt")||"[]");a()}}function u(a,b){G.prototype.constructor.call(this);this.type=a;this.I=b}function na(a,b,c){var d;u.prototype.constructor.call(this,Zc,1);this.M=v.fc(a,$c,ad);this.qb=1;this.De=(d=2*Math.PI,0+(d-0)*Math.random());this.Md=b;this.Re=c;this.pc=this.Gd=p;this.Ga=[]}function D(a,b,c,d){u.prototype.constructor.call(this,a,d);this.N=new E(b,c)}function sb(a,b){D.prototype.constructor.call(this,bd,a,Ob,0);this.b=b}function wa(a){u.prototype.constructor.call(this,
-1,0);this.N=new E(a,tc);this.$=0;n.ra(Pb)}function Ka(a,b,c){D.prototype.constructor.call(this,cd,a,Qb,dd);this.b=new g(c*Math.cos(b),c*Math.sin(b));this.nc=uc}function oa(a,b,c){u.prototype.constructor.call(this,ed,0);this.M=v.fc(a,fd,gd);this.Mb=o;this.text=b;this.Wb=p;this.$=0;this.Ke=c===undefined?hd:c}function La(a,b,c,d){u.prototype.constructor.call(this,a,d);this.N=new E(b,c)}function Rb(a){this.Ma=[];this.za=new g(a.x*y,a.y*y);this.za.x+=(Math.random()-0.5)*Ma;this.za.y+=(Math.random()-0.5)*
Ma;this.k=Math.random()*Math.PI*2}function pa(a,b){La.prototype.constructor.call(this,id,a,Ma,jd);this.target=b;this.dd=this.$c=p;this.Xe=new g(0,-10);this.Za=[];for(var c=0;c<4;c++)this.Za.push(new Rb(a))}function Xa(a,b){D.prototype.constructor.call(this,kd,a,Sb,1);this.wc=ld;this.b=new g(vc*Math.cos(b),vc*Math.sin(b))}function Ya(a,b){D.prototype.constructor.call(this,md,a,wc,0);this.b=new g(xc*Math.cos(b),xc*Math.sin(b))}function X(a,b,c,d,e){u.prototype.constructor.call(this,a,e);this.N=new E(b,
c);this.U=d}function xa(a,b){X.prototype.constructor.call(this,nd,a,yc,0,0);this.target=b;this.Kb=new g(0,0)}function ya(a){X.prototype.constructor.call(this,od,a,pd,0,qd);this.o=new z;this.o.p=function(b){for(var c=-1;c<=1;c+=2){b.fillStyle="red";b.beginPath();b.moveTo(-0.3,c*0.05);b.lineTo(-0.3,c*0.15);b.lineTo(-0.3+(0.15-0.05),c*0.15);b.lineTo(-0.3+(0.15-0.05),c*0.05);b.fill();b.fillStyle="blue";b.beginPath();b.moveTo(0.3,c*0.05);b.lineTo(0.3,c*0.15);b.lineTo(0.3-(0.15-0.05),c*0.15);b.lineTo(0.3-
(0.15-0.05),c*0.05);b.fill()}b.strokeStyle="black";b.beginPath();b.arc(0.15,0,0.15,1.5*Math.PI,0.5*Math.PI,l);b.lineTo(0.3,0.15);b.lineTo(0.3,0.05);b.arc(0.15,0,0.05,0.5*Math.PI,1.5*Math.PI,p);b.lineTo(0.3,-0.05);b.lineTo(0.3,-0.15);b.lineTo(0.15,-0.15);b.stroke();b.beginPath();b.arc(-0.15,0,0.15,1.5*Math.PI,2.5*Math.PI,p);b.lineTo(-0.3,0.15);b.lineTo(-0.3,0.05);b.arc(-0.15,0,0.05,2.5*Math.PI,1.5*Math.PI,l);b.lineTo(-0.3,-0.05);b.lineTo(-0.3,-0.15);b.lineTo(-0.15,-0.15);b.stroke()}}function qa(a){X.prototype.constructor.call(this,
rd,a,sd,0,td);this.z=Tb;this.R=new g(0,0);this.Cb=0;this.d=[new z,new z,new z];this.d[ja].p=function(b){b.beginPath();b.arc(0,0,0.1,0,2*Math.PI,p);b.stroke()};this.d[Ub].p=this.d[tb].p=function(b){b.beginPath();b.moveTo(0,0.1);for(var c=0;c<=6;c++)b.lineTo((c&1)/24,0.2+c*0.05);b.arc(0,0.2,0.3,0.5*Math.PI,-0.5*Math.PI,l);b.stroke()};this.d[Ub].K(this.d[ja]);this.d[tb].K(this.d[ja]);this.d[tb].bb=l;this.d[ja].nb=new g(0,-0.2)}function zc(a){a.strokeStyle="black";a.beginPath();a.moveTo(-Y,0.075);a.lineTo(Y-
0.075,0.075);a.lineTo(Y,0);a.lineTo(Y-0.075,-0.075);a.lineTo(-Y,-0.075);a.closePath();a.fill();a.stroke()}function aa(a,b,c,d,e){X.prototype.constructor.call(this,e,a,Y,c,ud);this.target=b;this.se=d;this.Fd=vd;this.oc=0;this.b=new g(ub*Math.cos(c),ub*Math.sin(c));this.d=[new z,new z];this.d[Za].p=function(f){f.fillStyle="red";zc(f)};this.d[$a].p=function(f){f.fillStyle="blue";zc(f)}}function Ac(a,b){a.strokeStyle="black";a.fillStyle=b?"blue":"red";a.beginPath();a.moveTo(-Y,0.1);a.arc(Y-0.1,0,0.1,
Math.PI/2,-Math.PI/2,l);a.lineTo(-Y,-0.1);a.fill();a.stroke();a.fillStyle=b?"red":"blue";a.beginPath();a.arc(-Y,0,0.1,-Math.PI/2,Math.PI/2,p);a.closePath();a.fill();a.stroke()}function ab(a,b,c,d){aa.prototype.constructor.call(this,a,b,c,wd,xd);this.b=new g(vb*Math.cos(c),vb*Math.sin(c));this.gd=d;this.Uc=yd;this.d[Za].p=function(e){Ac(e,p)};this.d[$a].p=function(e){Ac(e,l)}}function za(a,b){La.prototype.constructor.call(this,zd,a,Ad,0);this.target=b;this.xb=p;this.o=new z;this.o.p=function(c){c.beginPath();
c.moveTo(0,-0.15);c.lineTo(0.05,-0.1);c.lineTo(0,0.1);c.lineTo(-0.05,-0.1);c.fill();c.beginPath();for(var d=-1;d<=1;d+=2){c.moveTo(0,-0.3);c.lineTo(d*0.05,-0.2);c.lineTo(d*0.1,-0.225);c.lineTo(d*0.1,-0.275);c.lineTo(d*0.15,-0.175);c.lineTo(0,0.3);c.moveTo(0,-0.15);c.lineTo(d*0.05,-0.1);c.lineTo(0,0.1)}c.stroke()}}function H(a,b,c,d,e,f,h){u.prototype.constructor.call(this,a,e);this.Dd=f;this.tb=h;this.M=v.fc(b,c,d)}function ra(a,b){H.prototype.constructor.call(this,Bd,a,Cd,wb,Dd,Bc,0+(Bc-0)*Math.random());
if(b<Math.PI*0.25)this.ma(new g(bb,0));else if(b<Math.PI*0.75)this.ma(new g(0,bb));else if(b<Math.PI*1.25)this.ma(new g(-bb,0));else b<Math.PI*1.75?this.ma(new g(0,-bb)):this.ma(new g(bb,0))}function Aa(a,b){H.prototype.constructor.call(this,Ed,a,Fd,Gd,0,Hd,0);this.target=b;this.Tb=l;this.k=0;this.o=new z;this.o.p=this.target===n.i?function(c){c.strokeStyle="black";c.beginPath();c.moveTo(0,-0.1);c.lineTo(-0.3,-0.1);c.lineTo(-0.3,0.1);c.lineTo(0,0.1);c.stroke();c.fillStyle="red";c.beginPath();c.arc(0,
0,0.2,0,2*Math.PI,p);c.fill();c.fillStyle="blue";c.beginPath();c.arc(0,0,0.2,1.65*Math.PI,2.35*Math.PI,p);c.fill();c.strokeStyle="black";c.beginPath();c.arc(0,0,0.2,0,2*Math.PI,p);c.stroke();c.beginPath();c.moveTo(0.1,-0.18);c.lineTo(0.1,0.18);c.stroke()}:function(c){c.strokeStyle="black";c.beginPath();c.moveTo(0,-0.1);c.lineTo(-0.3,-0.1);c.lineTo(-0.3,0.1);c.lineTo(0,0.1);c.stroke();c.fillStyle="blue";c.beginPath();c.arc(0,0,0.2,0,2*Math.PI,p);c.fill();c.fillStyle="red";c.beginPath();c.arc(0,0,0.2,
1.65*Math.PI,2.35*Math.PI,p);c.fill();c.strokeStyle="black";c.beginPath();c.arc(0,0,0.2,0,2*Math.PI,p);c.stroke();c.fillStyle="black";c.beginPath();c.moveTo(0.1,-0.18);c.lineTo(0.1,0.18);c.stroke()}}function Na(a,b){H.prototype.constructor.call(this,Id,a,Jd,Kd,0,Cc,0+(Cc-0)*Math.random());this.target=b;this.rb=this.wa=0;this.o=new z;this.o.p=function(c){c.beginPath();c.moveTo(-0.25,-0.25);c.lineTo(-0.175,-0.25);c.lineTo(-0.175,-0.02);c.lineTo(0,0.175);c.lineTo(0.175,-0.02);c.lineTo(0.175,-0.25);c.lineTo(0.25,
-0.25);c.lineTo(0.25,0);c.lineTo(0,0.27);c.lineTo(-0.25,0);c.closePath();c.fill();c.stroke()}}function Oa(a,b){H.prototype.constructor.call(this,Ld,a,Md,Nd,0,Dc,0);this.direction=b;this.Hb=0;this.d=[new z,new z];this.d[xb].p=this.d[cb].p=function(c){c.strokeStyle="black";c.beginPath();for(var d=0;d<Z;d++){var e=d*(2*Math.PI/Z);c.moveTo(0,0);c.lineTo(0.2*Math.cos(e),0.2*Math.sin(e))}c.stroke()}}function Ba(a){var b,c,d;H.prototype.constructor.call(this,Od,a,Pd,Qd,0,Rd,0);this.Fa=this.Ca=o;this.ac=
Array(4);this.g=Array(4);a=this.a();this.Ca=new g(a.x,a.y);this.Fa=new g(a.x,a.y);this.g[0]=this.M.m;this.g[1]=new g(this.M.eb(),this.M.m.y);this.g[2]=new g(this.M.m.x,this.M.gb());this.g[3]=(b=this.M.m,c=new g(this.M.$b(),this.M.Qc()),d=new g(0,0),d.x=b.x+c.x,d.y=b.y+c.y,d)}function Vb(a){for(var b=[],c=0;c<a;c++)b.push(0.5+1*Math.random());return function(d){d.strokeStyle="black";d.beginPath();for(var e=0;e<a;e++){var f=e*(2*Math.PI/a),h=Ec*b[e];d.moveTo(0,0);d.lineTo(Math.cos(f)*h,Math.sin(f)*
h)}d.stroke()}}function Ca(a){var b;u.prototype.constructor.call(this,Sd,0);this.N=new E(a,Ec);this.d=[new z,new z,new z];this.d[0].p=Vb(11);this.d[1].p=Vb(13);this.d[2].p=Vb(7);this.d[1].K(this.d[0]);this.d[2].K(this.d[0]);this.d[0].k=(b=2*Math.PI,0+(b-0)*Math.random());this.d[1].k=(b=2*Math.PI,0+(b-0)*Math.random());this.d[2].k=(b=2*Math.PI,0+(b-0)*Math.random())}function Pa(a,b){D.prototype.constructor.call(this,Td,a,Ud,0);this.target=b;this.bd=p;this.d=[new z,new z,new z];this.d[db].p=function(c){c.strokeStyle=
"black";c.beginPath();c.arc(0,0,0.1,0,2*Math.PI,p);c.stroke();c.fill()};this.d[Wb].p=this.d[Xb].p=function(c){c.strokeStyle="black";c.beginPath();c.arc(0,0,0.2,0,Math.PI/2,p);c.arc(0,0,0.15,Math.PI/2,0,l);c.stroke();c.beginPath();c.moveTo(0.07,0.07);c.lineTo(0.1,0.1);c.stroke()};this.d[Wb].K(this.d[db]);this.d[Xb].K(this.d[db])}function ba(a,b,c,d){u.prototype.constructor.call(this,a,d);this.N=new E(b,c)}function ka(a,b,c){ba.prototype.constructor.call(this,-1,a,Yb,Vd);this.body=c;this.Id=new E(a,
Wd);this.b=b<=Math.PI*0.5||b>Math.PI*0.6666666?new g(yb,0):new g(-yb,0)}function Da(a,b){X.prototype.constructor.call(this,Xd,a,Yd,0,0);this.target=b;this.R=new g(0,0);this.ga=0;this.o=new z;this.o.p=function(c){c.beginPath();c.arc(0,0,0.1,0,2*Math.PI,p);c.fill();c.stroke();c.beginPath();for(var d=0;d<4;d++){var e=d*(2*Math.PI/4),f=Math.cos(e);e=Math.sin(e);c.moveTo(f*0.1,e*0.1);c.lineTo(f*0.3,e*0.3);c.moveTo(f*0.16-e*0.1,e*0.16+f*0.1);c.lineTo(f*0.16+e*0.1,e*0.16-f*0.1);c.moveTo(f*0.23-e*0.05,e*
0.23+f*0.05);c.lineTo(f*0.23+e*0.05,e*0.23-f*0.05)}c.stroke()}}function eb(a,b){ba.prototype.constructor.call(this,Zd,a,zb,0);this.Mc=l;this.yb=p;this.b=new g(Math.cos(b),Math.sin(b));this.o=new z;this.o.p=function(c){c.fillStyle="black";c.strokeStyle="black";c.beginPath();c.arc(0,0,0.25,Math.PI*0.25+0.15,Math.PI*0.75-0.15,p);c.stroke();c.beginPath();c.arc(0,0,0.25,Math.PI*0.75+0.15,Math.PI*1.25-0.15,p);c.stroke();c.beginPath();c.arc(0,0,0.25,Math.PI*1.25+0.15,Math.PI*1.75-0.15,p);c.stroke();c.beginPath();
c.arc(0,0,0.25,Math.PI*1.75+0.15,Math.PI*2.25-0.15,p);c.stroke();c.beginPath();c.arc(0,0,0.15,0,2*Math.PI,p);c.stroke();c.beginPath();c.moveTo(0.15,0);c.lineTo(0.25,0);c.moveTo(0,0.15);c.lineTo(0,0.25);c.moveTo(-0.15,0);c.lineTo(-0.25,0);c.moveTo(0,-0.15);c.lineTo(0,-0.25);c.stroke();c.beginPath();c.arc(0,0,0.05,0,2*Math.PI,p);c.fill()}}function Qa(a,b){ba.prototype.constructor.call(this,$d,a,Ea,ae);this.Tc=p;this.ga=0;this.Je=Math.cos(b)>0;this.o=new z;this.o.p=function(c){c.strokeStyle="black";
c.beginPath();c.arc(0,0,Ea,0,2*Math.PI,p);c.arc(0,0,Ea-0.1,Math.PI,3*Math.PI,p);c.stroke();c.fillStyle="black";for(var d=0;d<4;d++){var e=d*(2*Math.PI/4),f=e+Math.PI/4;c.beginPath();c.arc(0,0,Ea,e,f,p);c.arc(0,0,Ea-0.1,f,e,l);c.fill()}}}function sa(){this.zc=new Fc;this.Xb=this.Yb=0;this.ad=p;this.hc=o;this.fd=p;n=new O}function Zb(a,b,c,d,e){var f=b.length;if(!(f<1)){a.font=e+"px Arial, sans-serif";e=e+2;for(var h=e*f,i=-1,j=0;j<f;++j){var k=a.measureText(b[j]).width;if(i<k)i=k}a.fillStyle="#BFBFBF";
a.strokeStyle="#7F7F7F";a.lineWidth=1;j=c-i/2-$b;k=d-h/2-ac;a.fillRect(j,k,i+$b*2,h+ac*2);a.strokeRect(j,k,i+$b*2,h+ac*2);a.fillStyle="black";a.textAlign="center";d=d+4-(f-1)*e/2;for(j=0;j<f;++j){a.fillText(b[j],c,d);d+=e}}}function Ab(a){return a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}function Gc(a,b,c){function d(){$("#loadingScreen").html("Could not load "+a+" from<br><b>"+Ab(b)+"</b>")}$.ajax({url:b,type:"GET",cache:p,
dataType:"json",success:function(e){e!=o?c(e):d()},error:function(){d()}})}function be(a,b,c){this.J=a;this.title=b;this.Xd=c}function ta(){this.A=o;this.ta=[];this.sa=p;this.selectedIndex=-1}function Fa(){this.J=this.A=o;this.sa=p;this.width=800;this.height=600;this.jc=0;this.canvas=$("#canvas")[0];this.context=this.canvas.getContext("2d");this.ec=new Date;this.ed=this.X=o}function Ra(){this.vd=this.hash=this.J=this.A=o}function Hc(){var a=$("body").scrollTop(),b=$(window).height(),c=$("#game").offset().top,
d=$("#game").outerHeight();if(c<a||c+d>a+b)$("html, body").animate({scrollTop:c+(d-b)/2})}function Ic(){if(U.le())if(U.A==o)U.Ib("rapt",o);else if(U.J==o){ca.X=o;var a=P.bc(ca.A,ca.J);if(a!==-1)P.selectedIndex=a;P.load(U.A,function(){P.show()});P.show()}else{Hc();P.load(U.A);ca.load(U.A,U.J,function(){ca.show()});ca.show()}ca.B()}function ce(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+c*24*60*60*1E3);c="; expires="+d.toGMTString()}else c="";document.cookie=a+"="+escape(b)+c+"; path=/"}function Yc(a){a=
a+"=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];d.charAt(0)==" ";)d=d.substring(1,d.length);if(d.indexOf(a)==0)return unescape(d.substring(a.length,d.length))}return o}function z(){this.k=this.bb=0;this.n=new g(0,0);this.nb=new g(0,0);this.p=this.nextSibling=this.firstChild=this.parent=o}function fb(a,b,c){if(b-a>Math.PI)a+=2*Math.PI;else if(a-b>Math.PI)a-=2*Math.PI;b=b-a;if(Math.abs(b)>c)b=b>0?c:-c;a+=b;a-=Math.floor(a/(2*Math.PI))*2*Math.PI;return a}function de(a){return a.toLowerCase().replace(/^(.)|\s(.)/g,
function(b){return b.toUpperCase()})}function g(a,b){this.x=a;this.y=b}function x(a,b){this.f=new g(a,b);this.xa=[]}function Sa(a,b,c,d,e){b/=50;c/=50;d/=50;e/=50;a.beginPath();a.moveTo(b,d);a.lineTo(c,e);a.lineTo(-c,e);a.lineTo(-b,d);a.closePath();a.fill();a.stroke()}function ee(){for(var a=[],b=0;b<fe;b++)a.push(new z);a[bc].p=function(c){var d=10,e=18;Sa(c,2.5,2.5,1,d);d/=50;e/=50;c.beginPath();c.moveTo(0,d);c.lineTo(0,e-0.02);c.arc(0,e,0.02,-Math.PI/2,Math.PI*3/2,p);c.stroke()};a[fa].p=function(c){Sa(c,
1.5,1.5,0,15)};a[cc].p=a[dc].p=function(c){Sa(c,1.5,1,0,-10)};a[ec].p=a[fc].p=function(c){Sa(c,1,1.5,0,-10)};a[Bb].p=a[Cb].p=function(c){Sa(c,1.5,0.5,0,-9)};a[gc].p=a[hc].p=function(c){Sa(c,0.5,1.5,0,-10)};a[bc].K(a[fa]);a[Bb].K(a[fa]);a[Cb].K(a[fa]);a[gc].K(a[Bb]);a[hc].K(a[Cb]);a[cc].K(a[fa]);a[dc].K(a[fa]);a[ec].K(a[cc]);a[fc].K(a[dc]);a[bc].n=new g(0,0.34);a[ec].n=new g(0,-0.2);a[fc].n=new g(0,-0.2);a[Bb].n=new g(0,0.3);a[Cb].n=new g(0,0.3);a[gc].n=new g(0,-0.18);a[hc].n=new g(0,-0.18);return a}
function J(a,b){G.prototype.constructor.call(this);this.reset(a,b)}function ge(){function a(d){d.strokeStyle="black";d.beginPath();d.moveTo(0,0);d.lineTo(0,-Jc);d.stroke()}for(var b=[],c=0;c<Kc;c++)b.push(new z);b[gb].p=function(d){d.strokeStyle="black";d.fillStyle="black";d.beginPath();d.moveTo(0.2,-0.2);d.lineTo(-0.2,-0.2);d.lineTo(-0.3,0);d.lineTo(-0.2,0.2);d.lineTo(0.2,0.2);d.lineTo(0.3,0);d.lineTo(0.2,-0.2);d.moveTo(0.15,-0.15);d.lineTo(-0.15,-0.15);d.lineTo(-0.23,0);d.lineTo(-0.15,0.15);d.lineTo(0.15,
0.15);d.lineTo(0.23,0);d.lineTo(0.15,-0.15);d.stroke();d.beginPath();d.arc(-0.075,0,0.04,0,2*Math.PI,p);d.arc(0.075,0,0.04,0,2*Math.PI,p);d.fill()};for(c=0;c<4;c++){b[Db+c].p=a;b[ic+c].p=a;b[Db+c].K(b[gb]);b[ic+c].K(b[Db+c]);b[ic+c].n=new g(0,-Jc)}b[Db].n=new g(-0.2,-0.2);b[he].n=new g(-0.1,-0.2);b[ie].n=new g(0.1,-0.2);b[je].n=new g(0.2,-0.2);return b}function Ga(a){ba.prototype.constructor.call(this,ke,a,Eb,le);this.gc=p;this.mc=Lc;this.d=ge()}function Mc(a){a.beginPath();for(var b=0;b<=21;b++){var c=
(0.25+0.5*b/21)*Math.PI,d=0.6+0.05*(b&2);a.lineTo(Math.cos(c)*d,Math.sin(c)*d-0.5)}for(b=21;b>=0;b--){c=(0.25+0.5*b/21)*Math.PI;a.lineTo(Math.cos(c)*0.5,Math.sin(c)*0.5-0.5)}a.fill()}function me(a){a.beginPath();a.moveTo(0,0);a.lineTo(0,-Nc);a.stroke()}function da(a,b){var c,d;H.prototype.constructor.call(this,ne,(c=new g(0,0.81-Yb+hb*0.5),d=new g(0,0),d.x=a.x+c.x,d.y=a.y+c.y,d),ea,hb,oe,pe,0);this.Sa=l;this.ib=new g(0,0);this.pb=new g(0,0);this.$=0;this.Ta=new ka(a,b,this);n.Ea(this.Ta,this.Ta.u().a());
c=[];for(d=0;d<Oc;d++){c.push(new z);c[d].p=d==0?Mc:me}for(d=jc;d<=Pc;d++)c[d].K(c[Fb]);for(d=kc;d<=Qc;d++)c[d].K(c[d-kc+jc]);c[jc].n=new g(ea*0.35,0);c[qe].n=new g(ea*0.15,0);c[re].n=new g(ea*-0.05,0);c[se].n=new g(ea*-0.25,0);c[te].n=new g(ea*0.25,0);c[ue].n=new g(ea*0.05,0);c[ve].n=new g(ea*-0.15,0);c[Pc].n=new g(ea*-0.35,0);for(d=kc;d<=Qc;d++)c[d].n=new g(0,-Nc);this.d=c;this.Qb=this.Pb=0}function Q(a,b,c){this.x=a;this.y=b;this.type=c;this.s=[]}function Ha(a,b,c,d){this.cells=[c,d];this.s=[a,
b]}function B(a,b,c){this.C=new M(a,b);this.color=c}function O(){this.j=new T(50,50,new g(0.5,0.5),new g(0.5,0.5));this.i=new J(this.j.na,Ta);this.r=new J(this.j.na,Ua);this.lc=0;this.Ed=new g(0,0);this.S=[];this.Ga=[];this.$=0;this.killKey=p;this.Wa=0;this.ca=lc;this.O=[0,0,0,0]}function Ia(a){return a.color===1?n.i:n.r}function ua(a){return new g(a[0],a[1])}function we(a){var b=ua(a.pos);switch(a.type){case "bomber":return new ra(b,a.angle);case "bouncy rocket launcher":return new Aa(b,Ia(a));case "corrosion cloud":return new xa(b,
Ia(a));case "doom magnet":return new ya(b);case "grenadier":return new Na(b,Ia(a));case "jet stream":return new Oa(b,a.angle);case "headache":return new pa(b,Ia(a));case "hunter":return new qa(b);case "multi gun":return new Ba(b);case "popper":return new Ga(b);case "rocket spider":return new da(b,a.angle);case "shock hawk":return new za(b,Ia(a));case "spike ball":return new Ca(b);case "stalacbat":return new Pa(b,Ia(a));case "wall avoider":return new Da(b,Ia(a));case "wall crawler":return new eb(b,
a.angle);case "wheeligator":return new Qa(b,a.angle);default:console.log("Invalid enemy type in level");return new Ca(b)}}function T(a,b,c,d){var e,f;this.cells=Array(a);for(var h=0;h<a;++h){this.cells[h]=Array(b);for(var i=0;i<b;++i)this.cells[h][i]=new Q(h,i,R)}this.width=a;this.height=b;this.Bd=c;this.na=(e=new g(0.5,0.5),f=new g(0,0),f.x=c.x+e.x,f.y=c.y+e.y,f);this.Sc=(e=new g(0.5,0.5),f=new g(0,0),f.x=d.x+e.x,f.y=d.y+e.y,f)}function Gb(a,b,c,d,e){a.fillRect(b,c,d,e);a.strokeRect(b,c,d,e)}v.fc=
function(a,b,c){var d;c=new g(b*0.5,c*0.5);b=(d=new g(0,0),d.x=a.x-c.x,d.y=a.y-c.y,d);a=(d=new g(0,0),d.x=a.x+c.x,d.y=a.y+c.y,d);return new v(b,a)};v.prototype.gb=function(){return this.m.y+this.size.y};v.prototype.eb=function(){return this.m.x+this.size.x};v.prototype.$b=function(){return this.size.x};v.prototype.Qc=function(){return this.size.y};v.prototype.copy=function(){var a,b,c;return new v(this.m,(a=this.m,b=this.size,c=new g(0,0),c.x=a.x+b.x,c.y=a.y+b.y,c))};v.prototype.Ha=function(){var a,
b,c=this.a(),d=(a=this.size,b=new g(0,0),b.x=a.x/2,b.y=a.y/2,b);return new F(c,new g(+d.x,+d.y),new g(-d.x,+d.y),new g(-d.x,-d.y),new g(+d.x,-d.y))};v.prototype.P=function(){return la};v.prototype.T=function(){return this};v.prototype.moveBy=function(a){var b,c;this.m=(b=this.m,c=new g(0,0),c.x=b.x+a.x,c.y=b.y+a.y,c)};v.prototype.moveTo=function(a){var b,c,d,e;this.m=(b=(d=this.size,e=new g(0,0),e.x=d.x/2,e.y=d.y/2,e),c=new g(0,0),c.x=a.x-b.x,c.y=a.y-b.y,c)};v.prototype.a=function(){var a,b,c,d,e;
return a=this.m,b=(d=this.size,e=new g(0,0),e.x=d.x/2,e.y=d.y/2,e),c=new g(0,0),c.x=a.x+b.x,c.y=a.y+b.y,c};v.prototype.expand=function(a){var b,c,d,e;a=new g(a,a);return new v((b=this.m,c=new g(0,0),c.x=b.x-a.x,c.y=b.y-a.y,c),(b=(c=this.m,d=this.size,e=new g(0,0),e.x=c.x+d.x,e.y=c.y+d.y,e),b.x+=a.x,b.y+=a.y,b))};v.prototype.Qe=function(a){var b,c,d,e,f;return new v((b=this.m,c=a.m,d=new g(0,0),d.x=Math.min(b.x,c.x),d.y=Math.min(b.y,c.y),d),(b=(d=this.m,e=this.size,f=new g(0,0),f.x=d.x+e.x,f.y=d.y+
e.y,f),c=(d=a.m,e=a.size,f=new g(0,0),f.x=d.x+e.x,f.y=d.y+e.y,f),b.x=Math.max(b.x,c.x),b.y=Math.max(b.y,c.y),b))};v.prototype.me=function(a){var b,c,d,e;return new v((b=this.m,c=new g(0,0),c.x=Math.min(b.x,a.x),c.y=Math.min(b.y,a.y),c),(b=(c=this.m,d=this.size,e=new g(0,0),e.x=c.x+d.x,e.y=c.y+d.y,e),b.x=Math.max(b.x,a.x),b.y=Math.max(b.y,a.y),b))};v.prototype.Fb=function(a){var b,c,d,e;return new v((b=this.m,c=new g(0,0),c.x=b.x+a.x,c.y=b.y+a.y,c),(b=(c=this.m,d=this.size,e=new g(0,0),e.x=c.x+d.x,
e.y=c.y+d.y,e),b.x+=a.x,b.y+=a.y,b))};v.prototype.e=function(a){a.strokeStyle="black";a.strokeRect(this.m.x,this.m.y,this.size.x,this.size.y)};E.prototype.copy=function(){return new E(this.f,this.h)};E.prototype.P=function(){return ga};E.prototype.T=function(){var a,b,c=new g(this.h,this.h);return new v((a=this.f,b=new g(0,0),b.x=a.x-c.x,b.y=a.y-c.y,b),(a=this.f,b=new g(0,0),b.x=a.x+c.x,b.y=a.y+c.y,b))};E.prototype.a=L("f");E.prototype.moveBy=function(a){var b,c;this.f=(b=this.f,c=new g(0,0),c.x=
b.x+a.x,c.y=b.y+a.y,c)};E.prototype.moveTo=function(a){this.f=a};E.prototype.Fb=function(a){var b,c;return new E((b=this.f,c=new g(0,0),c.x=b.x+a.x,c.y=b.y+a.y,c),this.h)};E.prototype.e=function(a){a.strokeStyle="black";a.beginPath();a.arc(this.f.x,this.f.y,this.h,0,Math.PI*2,p);a.stroke()};r.Ub=function(a,b,c,d,e,f){return this.Rd(a.u(),b,c,d,e,a.db(),f)};r.Rd=function(a,b,c,d,e,f,h){var i,j,k,m,q,s,t,w,I;if((i=b.c,i.x*i.x+i.y*i.y)<1.0E-12){b.c=new g(0,0);return o}if((i=c.c,i.x*i.x+i.y*i.y)>900)c.c=
(i=(j=c.c,k=new g(0,0),m=Math.sqrt(j.x*j.x+j.y*j.y),k.x=j.x/m,k.y=j.y/m,k),i.x*=30,i.y*=30,i);for(var V=o,xe=b.c,Rc=c.c,Sc=0;Sc<20;Sc++){var S=a.copy();S.moveBy(b.c);S=a.T().Qe(S.T());var va=e.zb(S,f);S=o;for(var Ja=0;Ja<va.length;Ja++){var mc=this.Qd(a,b.c,va[Ja].C);if(S===o||mc!==o&&mc.Ba<S.Ba)S=mc}if(S===o){this.Kc(a,b,c,e);return V}V=c.c.ob(S.q);va=(i=c.c,j=new g(0,0),j.x=i.x-V.x,j.y=i.y-V.y,j);c.c=(i=(k=-d,m=new g(0,0),m.x=V.x*k,m.y=V.y*k,m),j=new g(0,0),j.x=va.x+i.x,j.y=va.y+i.y,j);V=b.c.ob(S.q);
va=(i=b.c,j=new g(0,0),j.x=i.x-V.x,j.y=i.y-V.y,j);Ja=1-S.Ba;b.c=(i=(k=(q=(t=b.c,w=S.Ba,I=new g(0,0),I.x=t.x*w,I.y=t.y*w,I),s=(t=-d*Ja,w=new g(0,0),w.x=V.x*t,w.y=V.y*t,w),q.x+=s.x,q.y+=s.y,q),m=(q=new g(0,0),q.x=va.x*Ja,q.y=va.y*Ja,q),k.x+=m.x,k.y+=m.y,k),j=(k=S.q,m=new g(0,0),m.x=k.x*1.0E-4,m.y=k.y*1.0E-4,m),i.x+=j.x,i.y+=j.y,i);V=S}typeof console!=="undefined"&&console.log&&console.log("Collision loop ran out, damn!");b.c=new g(0,0);c.c=(i=-(d<0.5?d:0.5),j=new g(0,0),j.x=Rc.x*i,j.y=Rc.y*i,j);h&&
this.Kc(a,{c:xe},c,e);return V};r.rd=function(a){var b=[];this.Gb(n.i.u(),a)&&b.push(n.i);this.Gb(n.r.u(),a)&&b.push(n.r);return b};r.We=function(){return this.Gb(n.i.u(),n.r.u())};r.qd=function(a,b,c){this.ze(a,b,c);b.Le(0.01)};r.Ia=function(a,b,c){var d,e,f;if((d=(e=new g(0,0),e.x=b.x-a.x,e.y=b.y-a.y,e),d.x*d.x+d.y*d.y)>625)return o;c=c.zb(new v(a,b),Hb);for(var h=1.1,i={},j={},k=o,m=0;m<c.length;m++)if(!((d=(f=new g(0,0),f.x=b.x-a.x,f.y=b.y-a.y,f),e=c[m].C.q,d.x*e.x+d.y*e.y)>=0)){var q={};if(this.la(new M(a,
b),c[m].C,q,i,j))if(!(q.c>=h)){h=q.c;k=c[m]}}return k};r.$a=function(a,b,c,d,e){var f=a.u();b=f.T().expand(b);a=e.zb(b,a.db());e=Number.POSITIVE_INFINITY;for(b=0;b<a.length;b++){var h={},i={},j=this.Cc(f,h,i,a[b].C);if(j<e){e=j;c.c=h.c;d.c=i.c}}return e};r.Td=function(a,b){var c,d,e,f,h,i,j;switch(b.P()){case ga:return(c=(d=b.f,e=new g(0,0),e.x=a.x-d.x,e.y=a.y-d.y,e),c.x*c.x+c.y*c.y)<b.h*b.h;case la:return a.x>=b.m.x&&a.x<=b.m.x+b.size.x&&a.y>=b.m.y&&a.y<=b.m.y+b.size.y;case ha:for(var k=b.v.length,
m=0;m<k;++m)if((c=(e=(h=b.v[m],i=b.f,j=new g(0,0),j.x=h.x+i.x,j.y=h.y+i.y,j),f=new g(0,0),f.x=a.x-e.x,f.y=a.y-e.y,f),d=b.Na[m].q,c.x*d.x+c.y*d.y)>0)return p;return l}alert("assertion failed in CollisionDetector.containsPointShape")};r.Yc=function(a,b){return this.Zc(a.u(),b)};r.la=function(a,b,c,d,e){var f,h,i,j,k=a.start;a=a.end;a=(f=new g(0,0),f.x=a.x-k.x,f.y=a.y-k.y,f);var m=b.start;b=b.end;b=(f=new g(0,0),f.x=b.x-m.x,f.y=b.y-m.y,f);if(Math.abs((f=(h=new g(0,0),h.x=b.y,h.y=-b.x,h),a.x*f.x+a.y*
f.y))<1.0E-6)return p;c.c=((m.y-k.y)*b.x+(k.x-m.x)*b.y)/(a.y*b.x-b.y*a.x);d.c=((k.y-m.y)*a.x+(m.x-k.x)*a.y)/(b.y*a.x-a.y*b.x);e.c=(f=(i=c.c,j=new g(0,0),j.x=a.x*i,j.y=a.y*i,j),h=new g(0,0),h.x=k.x+f.x,h.y=k.y+f.y,h);if(c.c<0||c.c>1)return p;if(d.c<0||d.c>1)return p;return l};r.Wc=function(a,b,c,d){var e,f,h,i=b.start;b=b.end;var j=(e=new g(0,0),e.x=b.x-i.x,e.y=b.y-i.y,e);b=j.x*j.x+j.y*j.y;j=2*(e=(f=a.f,h=new g(0,0),h.x=i.x-f.x,h.y=i.y-f.y,h),j.x*e.x+j.y*e.y);a=(e=(f=a.f,h=new g(0,0),h.x=i.x-f.x,h.y=
i.y-f.y,h),e.x*e.x+e.y*e.y)-a.h*a.h;e=j*j-4*b*a;if(e<0)return p;c.c=(-j-Math.sqrt(e))*0.5/b;d.c=(-j+Math.sqrt(e))*0.5/b;return l};r.Zc=function(a,b){switch(a.P()){case ga:return this.Xc(a,b);case la:return this.cc(a.Ha(),b);case ha:return this.cc(a,b)}alert("assertion failed in CollisionDetector.intersectShapeSegment")};r.Xc=function(a,b){var c={},d={};if(!this.Wc(a,b,c,d))return p;if(c.c>=0&&c.c<=1)return l;return d.c>=0&&d.c<=1};r.cc=function(a,b){for(var c={},d={},e={},f=0;f<a.v.length;f++)if(this.la(a.fb(f),
b,c,d,e))return l;return p};r.Qd=function(a,b,c){var d=c.q;if(b.x*d.x+b.y*d.y>0)return o;switch(a.P()){case ga:return this.Pd(a,b,c);case la:return this.Ec(a.Ha(),b,c);case ha:return this.Ec(a,b,c)}alert("assertion failed in CollisionDetector.collideShapeSegment")};r.Pd=function(a,b,c){var d,e,f,h=c.q,i=(d=-a.h,e=new g(0,0),e.x=h.x*d,e.y=h.y*d,e);i=(d=(new E((d=a.f,e=new g(0,0),e.x=d.x+b.x,e.y=d.y+b.y,e),a.h)).f,e=new g(0,0),e.x=d.x+i.x,e.y=d.y+i.y,e);if(!((d=(e=c.start,f=new g(0,0),f.x=i.x-e.x,f.y=
i.y-e.y,f),d.x*h.x+d.y*h.y)<0.001))return o;var j=(d=new g(0,0),d.x=i.x-b.x,d.y=i.y-b.y,d);if((d=(e=c.start,f=new g(0,0),f.x=j.x-e.x,f.y=j.y-e.y,f),d.x*h.x+d.y*h.y)>0){d={};e={};if(this.la(c,new M(j,i),{},d,e))return new pb(e.c,h,d.c)}h=this.Dc(a,b,c.start);a=this.Dc(a,b,c.end);if(!h&&!a)return o;if(h&&!a)return h;if(!h&&a)return a;if(h.Ba<a.Ba)return h;return a};r.Dc=function(a,b,c){var d,e,f,h,i,j={};if(Math.sqrt(b.x*b.x+b.y*b.y)<1.0E-7)return p;if(!this.Wc(a,new M(c,(d=new g(0,0),d.x=c.x-b.x,d.y=
c.y-b.y,d)),j,{}))return o;if(j.c<0||j.c>1)return o;a=(d=a.f,e=(h=j.c,i=new g(0,0),i.x=b.x*h,i.y=b.y*h,i),f=new g(0,0),f.x=d.x+e.x,f.y=d.y+e.y,f);return new pb(c,(d=(f=new g(0,0),f.x=a.x-c.x,f.y=a.y-c.y,f),e=Math.sqrt(d.x*d.x+d.y*d.y),d.x/=e,d.y/=e,d),j.c)};r.Ec=function(a,b,c){var d,e,f,h,i={},j={},k={};if(this.cc(a,c))return o;var m=o,q;for(q=0;q<a.v.length;q++)for(var s=[c.start,c.end],t=(d=(e=c.start,f=c.end,h=new g(0,0),h.x=e.x+f.x,h.y=e.y+f.y,h),d.x/=2,d.y/=2,d),w=0;w<2;w++){var I=a.fb(q);if(!((d=
I.q,e=(f=s[w],h=new g(0,0),h.x=f.x-t.x,h.y=f.y-t.y,h),d.x*e.x+d.y*e.y)>0))if(this.la(I,new M(s[w],(d=s[w],e=new g(0,0),e.x=d.x-b.x,e.y=d.y-b.y,e)),i,j,k))if(!m||j.c<m.Ba)m=new pb(k.c,(d=I.q,e=-1,f=new g(0,0),f.x=d.x*e,f.y=d.y*e,f),j.c)}for(q=0;q<a.v.length;q++){e=a.hb(q);if(this.la(c,new M(e,(d=new g(0,0),d.x=e.x+b.x,d.y=e.y+b.y,d)),i,j,k))if(!m||j.c<m.Ba)m=new pb(k.c,c.q,j.c)}return m};r.Kc=function(a,b,c,d){var e,f,h,i,j,k=p;c=a.copy();c.moveBy(b.c);if(c.T().m.y<0)k=l;if(c.T().gb()>d.height)k=l;
if(c.T().m.x<0)k=l;if(c.T().eb()>d.width)k=l;if(!k)for(var m=d.fe(c.T()),q=0;q<m.length;q++){var s=m[q].u();if(s)if(this.Gb(c,s)){k=l;break}}if(k){var t=Math.floor(c.a().x)-3;k=Math.floor(c.a().x)+3;m=Math.floor(c.a().y)-3;q=Math.floor(c.a().y)+3;s=d.Bd;for(t=t;t<=k;t++)for(var w=m;w<=q;w++)if(!(!d.Y(t,w)||d.Y(t,w).type!=ib)){var I=new g(t+0.5,w+0.5);if((e=(f=c.a(),h=new g(0,0),h.x=I.x-f.x,h.y=I.y-f.y,h),e.x*e.x+e.y*e.y)<(e=(f=c.a(),h=new g(0,0),h.x=s.x-f.x,h.y=s.y-f.y,h),e.x*e.x+e.y*e.y))s=I}c.moveBy((e=
(f=(i=c.a(),j=new g(0,0),j.x=s.x-i.x,j.y=s.y-i.y,j),h=Math.sqrt(f.x*f.x+f.y*f.y),f.x/=h,f.y/=h,f),e.x*=0.1,e.y*=0.1,e));b.c=(e=c.a(),f=a.a(),h=new g(0,0),h.x=e.x-f.x,h.y=e.y-f.y,h)}};r.Gb=function(a,b){var c=o,d=a.copy(),e=b.copy();if(d.P()==la)d=d.Ha();if(e.P()==la)e=e.Ha();if(d.P()>e.P()){c=e;e=d;d=c}var f;c=d.P();var h=e.P();if(c==ga&&h==ga)f=this.we(d,e);else if(c==ga&&h==ha)f=this.ve(d,e);else if(c==ha&&h==ha)f=this.xe(d,e);else alert("assertion failed in CollisionDetector.overlapShapes");return f};
r.we=function(a,b){var c,d,e,f;return(c=(d=b.a(),e=a.a(),f=new g(0,0),f.x=d.x-e.x,f.y=d.y-e.y,f),c.x*c.x+c.y*c.y)<=(a.h+b.h)*(a.h+b.h)};r.ve=function(a,b){for(var c,d,e,f,h,i,j,k=b.v.length,m=0;m<k;++m){if(this.Xc(a,b.fb(m)))return l;if((c=(d=b.hb(m),e=a.f,f=new g(0,0),f.x=d.x-e.x,f.y=d.y-e.y,f),c.x*c.x+c.y*c.y)<a.h*a.h)return l}var q=a.f;for(m=0;m<k;++m)if((c=(e=(h=b.v[m],i=b.f,j=new g(0,0),j.x=h.x+i.x,j.y=h.y+i.y,j),f=new g(0,0),f.x=q.x-e.x,f.y=q.y-e.y,f),d=b.Na[m].q,c.x*d.x+c.y*d.y)>0)return p;
return l};r.xe=function(a,b){var c,d,e,f,h=a.v.length,i=b.v.length;for(f=0;f<h;++f)if(this.Fc((c=a.v[f],d=a.f,e=new g(0,0),e.x=c.x+d.x,e.y=c.y+d.y,e),b))return l;for(f=0;f<i;++f)if(this.Fc((c=b.v[f],d=b.f,e=new g(0,0),e.x=c.x+d.x,e.y=c.y+d.y,e),a))return l;return p};r.Fc=function(a,b){for(var c,d,e,f,h,i,j,k=b.v.length,m=0;m<k;++m)if((c=(e=(h=b.v[m],i=b.f,j=new g(0,0),j.x=h.x+i.x,j.y=h.y+i.y,j),f=new g(0,0),f.x=a.x-e.x,f.y=a.y-e.y,f),d=b.Na[m].q,c.x*d.x+c.y*d.y)>0)return p;return l};r.$d=function(a,
b){if(this.Zc(a,b))return 0;return this.Cc(a,{},{},b)};r.Te=function(a,b){switch(a.P()){case ga:return this.Zd(a,b);case la:return this.Hc(a.Ha(),b);case ha:return this.Hc(a,b)}alert("assertion failed in CollisionDetector.distanceShapePoint")};r.Zd=function(a,b){var c,d,e,f=(c=(d=a.f,e=new g(0,0),e.x=d.x-b.x,e.y=d.y-b.y,e),Math.sqrt(c.x*c.x+c.y*c.y));return f>a.h?f-a.h:0};r.Hc=function(a,b){for(var c,d,e={},f={},h={},i=Number.POSITIVE_INFINITY,j=0;j<a.v.length;j++){var k=a.fb(j);this.la(k,new M(b,
(c=k.q,d=new g(0,0),d.x=b.x+c.x,d.y=b.y+c.y,d)),e,f,h);if(!(e.c<0||e.c>1)){k=Math.abs(f.c);if(k<i)i=k}}return i};r.Cc=function(a,b,c,d){switch(a.P()){case ga:return this.Od(a,b,c,d);case la:return this.Bc(a.Ha(),b,c,d);case ha:return this.Bc(a,b,c,d)}alert("assertion failed in CollisionDetector.closestToShapeSegment")};r.Od=function(a,b,c,d){var e,f,h,i,j,k,m,q,s,t,w={},I={};this.la(d,new M(a.f,(e=a.f,f=d.q,h=new g(0,0),h.x=e.x-f.x,h.y=e.y-f.y,h)),w,I,c);if(w.c>=0&&w.c<=1){b.c=(e=a.f,f=(i=d.q,j=a.h*
(I.c>0?1:-1),k=new g(0,0),k.x=i.x*j,k.y=i.y*j,k),h=new g(0,0),h.x=e.x-f.x,h.y=e.y-f.y,h);return(e=(f=c.c,h=a.f,i=new g(0,0),i.x=f.x-h.x,i.y=f.y-h.y,i),Math.sqrt(e.x*e.x+e.y*e.y))-a.h}w=(e=(f=a.f,h=d.start,i=new g(0,0),i.x=f.x-h.x,i.y=f.y-h.y,i),e.x*e.x+e.y*e.y);I=(e=(f=a.f,h=d.end,i=new g(0,0),i.x=f.x-h.x,i.y=f.y-h.y,i),e.x*e.x+e.y*e.y);if(w<I){c.c=d.start;b.c=(e=a.f,f=(i=(k=(q=c.c,s=a.f,t=new g(0,0),t.x=q.x-s.x,t.y=q.y-s.y,t),m=Math.sqrt(k.x*k.x+k.y*k.y),k.x/=m,k.y/=m,k),j=a.h,i.x*=j,i.y*=j,i),h=
new g(0,0),h.x=e.x+f.x,h.y=e.y+f.y,h);return Math.sqrt(w)-a.h}c.c=d.end;b.c=(e=a.f,f=(i=(k=(q=c.c,s=a.f,t=new g(0,0),t.x=q.x-s.x,t.y=q.y-s.y,t),m=Math.sqrt(k.x*k.x+k.y*k.y),k.x/=m,k.y/=m,k),j=a.h,i.x*=j,i.y*=j,i),h=new g(0,0),h.x=e.x+f.x,h.y=e.y+f.y,h);return Math.sqrt(I)-a.h};r.Bc=function(a,b,c,d){for(var e,f,h=Number.POSITIVE_INFINITY,i,j=0;j<a.v.length;j++)for(var k=a.hb(j),m=0;m<2;m++){var q=m==0?d.start:d.end;i=(e=(f=new g(0,0),f.x=k.x-q.x,f.y=k.y-q.y,f),Math.sqrt(e.x*e.x+e.y*e.y));if(i<h){h=
i;c.c=q;b.c=k}}m={};q={};var s={};for(j=0;j<a.v.length;j++){k=a.hb(j);this.la(d,new M(k,(e=d.q,f=new g(0,0),f.x=k.x-e.x,f.y=k.y-e.y,f)),m,q,s);if(!(m.c<0||m.c>1)){i=Math.abs(q.c);if(i<h){h=i;c.c=s.c;b.c=k}}}k={};var t={};for(j=0;j<a.v.length;j++){var w=a.fb(j);for(m=0;m<2;m++){q=m==0?d.start:d.end;this.la(w,new M(q,(e=w.q,f=new g(0,0),f.x=q.x+e.x,f.y=q.y+e.y,f)),k,t,s);if(!(k.c<0||k.c>1)){i=Math.abs(t.c);if(i<h){h=i;c.c=q;b.c=s.c}}}}return h};r.ze=function(a,b,c){var d=a.u();b.od();a=c.zb(d.T().expand(0.1),
a.db());for(c=0;c<a.length;c++)if(!(this.$d(d,a[c].C)>0.01)){var e=this.Ae(d,a[c].C);e<0||b.te(a[c],e)}};r.Ae=function(a,b){switch(a.P()){case ga:return this.ye(a,b);case la:return this.sd(a.Ha(),b);case ha:return this.sd(a,b)}alert("assertion failed in CollisionDetector.penetrationShapeSegment")};r.ye=function(a,b){var c,d,e,f,h=(c=b.q,d=-a.h,e=new g(0,0),e.x=c.x*d,e.y=c.y*d,e);h=(c=a.f,d=new g(0,0),d.x=c.x+h.x,d.y=c.y+h.y,d);return c=(e=b.start,f=new g(0,0),f.x=h.x-e.x,f.y=h.y-e.y,f),d=b.q,c.x*
d.x+c.y*d.y};r.sd=function(a,b){for(var c,d,e=Number.POSITIVE_INFINITY,f={},h={},i={},j=0;j<a.v.length;j++){var k=a.hb(j);this.la(b,new M(k,(c=b.q,d=new g(0,0),d.x=k.x-c.x,d.y=k.y-c.y,d)),f,h,i);if(!(f.c<0||f.c>1))if(h.c<e)e=h.c}return e};qb.prototype.od=function(){this.s=[o,o,o,o]};qb.prototype.te=function(a,b){var c=a.qa();if(this.s[c]==o||b<this.ic[c]){this.s[c]=a;this.ic[c]=b}};qb.prototype.Le=function(a){for(var b=0;b<4;b++)if(this.ic[b]>a)this.s[b]=o};var W=new qb;F.prototype.copy=function(){var a=
new F(this.f,this.v[0]);a.v=this.v;a.Na=this.Na;a.Vc();return a};F.prototype.P=function(){return ha};F.prototype.moveBy=function(a){var b,c;this.f=(b=this.f,c=new g(0,0),c.x=b.x+a.x,c.y=b.y+a.y,c)};F.prototype.moveTo=function(a){this.f=a};F.prototype.hb=function(a){var b,c,d;return b=this.v[a],c=this.f,d=new g(0,0),d.x=b.x+c.x,d.y=b.y+c.y,d};F.prototype.fb=function(a){return this.Na[a].Fb(this.f)};F.prototype.T=function(){return this.Sb.Fb(this.f)};F.prototype.a=L("f");F.prototype.Vc=function(){for(var a=
0;a<this.v.length;a++)this.Sb=this.Sb.me(this.v[a])};F.prototype.e=function(a){a.strokeStyle="black";a.beginPath();for(var b=0;b<this.v.length;b++)a.lineTo(this.v[b].x+this.f.x,this.v[b].y+this.f.y);a.closePath();a.stroke()};M.prototype.Fb=function(a){var b,c;return new M((b=this.start,c=new g(0,0),c.x=b.x+a.x,c.y=b.y+a.y,c),(b=this.end,c=new g(0,0),c.x=b.x+a.x,c.y=b.y+a.y,c))};M.prototype.e=function(a){a.beginPath();a.moveTo(this.start.x,this.start.y);a.lineTo(this.end.x,this.end.y);a.stroke()};
var ga=0,la=1,ha=2;G.prototype.ma=function(a){this.b=a};G.prototype.w=function(a){if(this.l!==a)(this.l=a)&&this.L()};G.prototype.a=function(){return this.u().a()};G.prototype.Cd=function(a){this.u().moveTo(a)};G.prototype.db=function(){throw"Entity.getColor() unimplemented";};G.prototype.u=function(){throw"Entity.getShape() unimplemented";};G.prototype.a=function(){return this.u().a()};G.prototype.Cd=function(a){this.u().moveTo(a)};G.prototype.Bb=function(){r.qd(this,W,n.j);return W.s[ia]!=o};G.prototype.B=
function(){throw"Entity.tick() unimplemented";};G.prototype.e=function(){throw"Entity.draw() unimplemented";};G.prototype.L=K();C.prototype.ne=function(){this.re=this.nd=this.lb=this.va=this.Ja=this.Ka=this.La=this.mb=this.Eb=0;this.md=this.kd=1;this.Q=new g(0,0);this.Va=new g(0,0);this.jd=this.kb=0;this.ld=o};C.prototype.B=function(a){var b,c,d,e,f;if(this.Eb<0)return p;this.va*=Math.pow(this.kd,a);this.lb*=Math.pow(this.md,a);this.Va.y-=this.nd*a;this.Q=(b=this.Q,c=(e=this.Va,f=new g(0,0),f.x=e.x*
a,f.y=e.y*a,f),d=new g(0,0),d.x=b.x+c.x,d.y=b.y+c.y,d);this.kb+=this.jd*a;if(this.va<0.05)this.Eb=-1;return this.Eb>=0};C.prototype.e=function(a){var b,c,d,e,f,h;switch(this.mb){case 0:a.fillStyle=rb(this.La,this.Ka,this.Ja,this.va);a.beginPath();a.arc(this.Q.x,this.Q.y,this.lb,0,2*Math.PI,p);a.fill();break;case 1:var i=(b=this.Q,c=(e=this.Va,f=new g(0,0),f.x=e.x*0.04,f.y=e.y*0.04,f),d=new g(0,0),d.x=b.x+c.x,d.y=b.y+c.y,d),j=(b=this.Q,c=(e=(f=this.Va,h=new g(0,0),h.x=f.y,h.y=-f.x,h),e.x*=0.01,e.y*=
0.01,e),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d),k=(b=this.Q,c=(e=(f=this.Va,h=new g(0,0),h.x=f.y,h.y=-f.x,h),e.x*=0.01,e.y*=0.01,e),d=new g(0,0),d.x=b.x+c.x,d.y=b.y+c.y,d);a.fillStyle=rb(this.La,this.Ka,this.Ja,this.va);a.beginPath();a.moveTo(i.x,i.y);a.lineTo(j.x,j.y);a.lineTo(k.x,k.y);a.closePath();a.fill();break;case 2:b=Math.cos(this.kb)*this.lb;c=Math.sin(this.kb)*this.lb;a.strokeStyle=rb(this.La,this.Ka,this.Ja,this.va);a.beginPath();a.moveTo(this.Q.x-b,this.Q.y-c);a.lineTo(this.Q.x+b,this.Q.y+
c);a.stroke();break;case 3:a.fillStyle=rb(this.La,this.Ka,this.Ja,this.va);a.save();a.translate(this.Q.x,this.Q.y);a.rotate(this.kb);this.ld(a);a.restore()}};C.prototype.D=function(a,b){this.Eb=Math.round(ma(a,b));return this};C.prototype.pa=function(){this.mb=0;return this};C.prototype.Da=function(){this.mb=1;return this};C.prototype.Db=function(){this.mb=2;return this};C.prototype.Wd=function(a){this.mb=3;this.ld=a;return this};C.prototype.color=function(a,b,c,d){this.La=a;this.Ka=b;this.Ja=c;this.va=
d;return this};C.prototype.V=function(a,b,c,d){var e,f=Math.random();this.La=(e=this.La,e+(a-e)*f);this.Ka=(e=this.Ka,e+(b-e)*f);this.Ja=(e=this.Ja,e+(c-e)*f);this.va=(e=this.va,e+(d-e)*f);return this};C.prototype.h=function(a,b){this.lb=ma(a,b);return this};C.prototype.ka=function(a,b){this.nd=ma(a,b);return this};C.prototype.I=function(a,b){this.re=ma(a,b);return this};C.prototype.F=function(a,b){this.kd=ma(a,b);return this};C.prototype.expand=function(a,b){this.md=ma(a,b);return this};C.prototype.k=
function(a,b){this.kb=ma(a,b);return this};C.prototype.ga=function(a,b){this.jd=ma(a,b);return this};C.prototype.position=function(a){this.Q=a;return this};C.prototype.b=function(a){this.Va=a;return this};var A=function(){function a(){var f=d<c?b[d++]:b[c-1];f.ne();return f}for(var b=Array(3E3),c=b.length,d=0,e=0;e<b.length;e++)b[e]=new C;a.reset=function(){d=0};a.B=function(f){for(var h=0;h<d;h++)if(!b[h].B(f)){var i=b[h];b[h]=b[d-1];b[d-1]=i;d--;h--}};a.e=function(f){for(var h=0;h<d;h++){var i=
b[h],j=i.Q;j.x>=jb&&j.y>=kb&&j.x<=lb&&j.y<=mb&&i.e(f)}};return a}();Mb.prototype.e=function(a,b,c,d,e){var f=1;if(this.Wa!=n.Wa||b<this.ub||d>this.Nb||c<this.vb||e>this.Ob||this.jc!=f){this.Wa=n.Wa;var h=2*(d-b),i=2*(e-c);this.ub=b-h/4;this.vb=c-i/4;this.Nb=d+h/4;this.Ob=e+i/4;d=Math.ceil(h*y);i=Math.ceil(i*y);this.width=d;this.height=i;this.canvas.width=Math.round(this.width*f);this.canvas.height=Math.round(this.height*f);this.ia.scale(f,f);this.ia.fillStyle="#BFBFBF";this.ia.fillRect(0,0,d,i);this.ia.save();
this.ia.translate(d/2,i/2);this.ia.scale(y,-y);this.ia.lineWidth=1/y;this.ia.translate(-(this.ub+this.Nb)/2,-(this.vb+this.Ob)/2);n.j.e(this.ia,this.ub,this.vb,this.Nb,this.Ob);this.ia.restore()}a.Ve=p;a.save();f=1;a.setTransform(f,0,0,f,0,0);a.drawImage(this.canvas,Math.round((this.ub-b)*y),Math.round((2*c-e-this.vb)*y),this.width,this.height);a.restore()};var rc=l;qc.prototype.e=function(a,b){var c,d,e,f,h=this.i.a(),i=this.r.a(),j=(c=(d=new g(0,0),d.x=h.x+i.x,d.y=h.y+i.y,d),c.x/=2,c.y/=2,c),k=
(c=(e=new g(0,0),e.x=i.x-h.x,e.y=i.y-h.y,e),d=Math.sqrt(c.x*c.x+c.y*c.y),c.x/=d,c.y/=d,c);k=new g(this.width/Math.abs(k.x),this.height/Math.abs(k.y));k=Math.min(k.x,k.y)/4;if((c=(d=new g(0,0),d.x=i.x-h.x,d.y=i.y-h.y,d),c.x*c.x+c.y*c.y)>4*k*k){var m=(c=(d=(f=new g(0,0),f.x=i.x-h.x,f.y=i.y-h.y,f),e=Math.sqrt(d.x*d.x+d.y*d.y),d.x/=e,d.y/=e,d),c.x*=99,c.y*=99,c);f=(c=new g(0,0),c.x=m.y,c.y=-m.x,c);m=(c=new g(0,0),c.x=j.x-h.x,c.y=j.y-h.y,c);if(m.x*m.x+m.y*m.y>k*k)m=(c=(d=new g(0,0),e=Math.sqrt(m.x*m.x+
m.y*m.y),d.x=m.x/e,d.y=m.y/e,d),c.x*=k,c.y*=k,c);m=(c=new g(0,0),c.x=m.x+h.x,c.y=m.y+h.y,c);j=(c=new g(0,0),c.x=j.x-i.x,c.y=j.y-i.y,c);if(j.x*j.x+j.y*j.y>k*k)j=(c=(d=new g(0,0),e=Math.sqrt(j.x*j.x+j.y*j.y),d.x=j.x/e,d.y=j.y/e,d),c.x*=k,c.y*=k,c);j=(c=new g(0,0),c.x=j.x+i.x,c.y=j.y+i.y,c);a.save();sc(a,this.width/2,this.height/2,f);b.kc(a,m,this.width,this.height,this.Rb);a.restore();a.save();sc(a,this.width/2,this.height/2,(c=-1,d=new g(0,0),d.x=f.x*c,d.y=f.y*c,d));b.kc(a,j,this.width,this.height,
this.vc);a.restore();e=Math.min(0.1,((c=(d=new g(0,0),d.x=i.x-h.x,d.y=i.y-h.y,d),Math.sqrt(c.x*c.x+c.y*c.y))-1.9*k)*0.01);a.save();a.lineWidth=2*e;a.strokeStyle="black";a.beginPath();a.moveTo(-f.x,-f.y);a.lineTo(f.x,f.y);a.stroke();a.restore()}else b.kc(a,j,this.width,this.height,this.Rb)};var Fc=qc;Nb.prototype.Rc=function(a,b){for(var c=0;c<this.O.length;c++){var d=this.O[c];if(d.username==a&&d.levelname==b)return d}return{username:a,levelname:b,complete:p,gotAllCogs:p}};Nb.prototype.He=function(a,
b,c,d){for(var e=0;e<this.O.length;e++){var f=this.O[e];f.username==a&&f.levelname==b&&this.O.splice(e--,1)}f={username:a,levelname:b,complete:c,gotAllCogs:d};this.O.push(f);this.Gc!==o?$.ajax({url:"/stats/",type:"PUT",dataType:"json",data:JSON.stringify(f),beforeSend:function(h){h.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))},contentType:"application/json; charset=utf-8"}):ce("rapt",JSON.stringify(this.O),1825)};Function.prototype.t=function(a){$.extend(this.prototype,
a.prototype)};var bd=0,Bd=1,xd=2,Ed=3,nd=4,od=5,cd=6,Id=7,id=8,ed=9,rd=10,kd=11,Od=12,ke=13,md=14,Ld=15,ne=17,zd=19,Sd=20,Td=21,Xd=22,Zd=23,$d=24,Zc=25;u.t(G);u.prototype.B=function(a){var b,c,d,e,f;if(this.Pa())this.ma((b=this.b,c=(e=this.Ld(),f=new g(0,0),f.x=e.x*a,f.y=e.y*a,f),d=new g(0,0),d.x=b.x+c.x,d.y=b.y+c.y,d));b={c:this.move(a)};c={c:this.b};d=this.u();e=o;if(this.ba()){e=r.Ub(this,b,c,this.I,n.j,l);this.ma(c.c)}d.moveBy(b.c);e!==o&&this.ea(e);r.Td(d.a(),n.j.he())||this.w(l);if(!this.l){b=
r.rd(d);for(c=0;c<b.length;++c)b[c].l||this.Z(b[c])}this.H(a)};u.prototype.db=function(){return Hb};u.prototype.P=L("type");u.prototype.L=K();u.prototype.ba=N(l);u.prototype.Pa=N(p);u.prototype.fa=function(a,b){var c,d,e,f;this.ma((c=this.b,d=(f=new g(0,0),f.x=a.x*b,f.y=a.y*b,f),e=new g(0,0),e.x=c.x+d.x,e.y=c.y+d.y,e));return c=this.b,d=new g(0,0),d.x=c.x*b,d.y=c.y*b,d};u.prototype.Ld=function(){var a,b,c,d,e=(a=n.j.na,b=this.a(),c=new g(0,0),c.x=a.x-b.x,c.y=a.y-b.y,c),f=this.u().h;f=Math.sqrt(e.x*
e.x+e.y*e.y)-f;if(f<1)return a=(c=new g(0,0),d=Math.sqrt(e.x*e.x+e.y*e.y),c.x=e.x/d,c.y=e.y/d,c),b=-100,a.x*=b,a.y*=b,a;else if(f<1.1){f=100*(1-(f-1)/(1.1-1));return a=(c=new g(0,0),d=Math.sqrt(e.x*e.x+e.y*e.y),c.x=e.x/d,c.y=e.y/d,c),b=-f,a.x*=b,a.y*=b,a}else return new g(0,0)};u.prototype.move=function(){return new g(0,0)};u.prototype.ea=K();u.prototype.Z=function(a){a.w(l)};u.prototype.H=K();var $c=0.4,ad=0.76;na.t(u);na.prototype.u=L("M");na.prototype.tc=function(a){this.Ga.push(a)};na.prototype.ba=
N(p);na.prototype.B=function(a){this.qb+=a;if(this.qb>1)this.qb=1;this.pc=p;u.prototype.B.call(this,a);this.Gd=this.pc};na.prototype.Z=function(){var a,b,c;this.pc=l;if(!this.Gd){for(var d=0;d<this.Ga.length;++d)n.ge(this.Ga[d]).sc(this.Md,p,l);for(d=0;d<50;++d){var e=(a=2*Math.PI,0+(a-0)*Math.random()),f=(a=g.G(e),b=3+2*Math.random(),c=new g(0,0),c.x=a.x*b,c.y=a.y*b,c);A().position(this.a()).b(f).k(e).h(0.05).D(3).I(0.5).F(0.01).Db().color(1,1,1,1)}this.qb=0}};na.prototype.e=function(a){var b,c,
d,e;if(this.Re){var f=this.a(),h=this.De+2*Math.PI/3/(this.qb+0.1);a.fillStyle="white";a.strokeStyle="black";a.beginPath();a.arc(f.x,f.y,0.11,0,2*Math.PI,p);a.fill();a.stroke();a.beginPath();for(var i=0;i<3;++i){a.moveTo(f.x,f.y);var j=(b=(d=g.G(h+(i-0.5)*(2*Math.PI/3)),e=new g(0,0),e.x=d.x*0.11,e.y=d.y*0.11,e),c=new g(0,0),c.x=f.x+b.x,c.y=f.y+b.y,c);a.lineTo(j.x,j.y)}a.stroke()}};D.t(u);D.prototype.u=L("N");D.prototype.e=function(a){var b=this.N.f;a.fillStyle="black";a.beginPath();a.arc(b.x,b.y,
this.N.h,0,Math.PI*2,p);a.fill()};D.prototype.move=function(a){return this.fa(new g(0,-6),a)};D.prototype.ea=function(){this.w(l)};D.prototype.Z=function(a){this.w(l);a.w(l)};var Ob=0.15;sb.t(D);sb.prototype.L=function(){for(var a,b,c,d,e=this.u().a(),f=0;f<50;++f){var h=(a=g.G((d=2*Math.PI,0+(d-0)*Math.random())),b=0.5+6.5*Math.random(),c=new g(0,0),c.x=a.x*b,c.y=a.y*b,c);A().position(e).b(h).h(0.02,0.15).D(0,4).I(0.05,0.9).F(1.0E-5,1.0E-4).expand(1,1.2).color(1,0.5,0,1).V(1,1,0,1).Da()}A().position(e).h(0.1).D(0).ka(p).F(1.0E-6).expand(10).color(1,
1,1,5).pa()};var tc=0.25;wa.t(u);wa.prototype.u=L("N");wa.prototype.Z=function(){this.w(l)};wa.prototype.L=function(){var a,b,c,d,e;n.ca===lc&&n.ra(nc);for(var f=this.a(),h=0;h<100;++h){var i=g.G((a=2*Math.PI,0+(a-0)*Math.random()));i=(a=this.b,b=(d=1+4*Math.random(),e=new g(0,0),e.x=i.x*d,e.y=i.y*d,e),c=new g(0,0),c.x=a.x+b.x,c.y=a.y+b.y,c);A().position(f).b(i).h(0.01,1.5).D(0,4).I(0.05,0.9).F(0.01,0.5).color(0.9,0.87,0,1).V(1,0.96,0,1).Da()}};wa.prototype.H=function(a){this.$+=a};wa.prototype.e=
function(a){var b=this.a(),c=b.x;b=b.y;var d=this.$;a.save();a.strokeStyle="rgb(255, 245, 0)";a.fillStyle="rgb(255, 245, 0)";a.translate(c,b);a.rotate(d*Math.PI/2);c=tc;b=c*0.8;d=c*0.125;for(var e=c*0.05,f=0;f<2;f++){for(var h=0;h<=f;h++){a.beginPath();for(var i=0;i<=64;i++){var j=(i+0.25)/64*2*Math.PI,k=Math.sin(j),m=Math.cos(j),q=c*0.7;j=c*(1+Math.cos(j*16*0.5)*0.1);if(!f||!h)a.lineTo(m*q,k*q);if(!f||h)a.lineTo(m*j,k*j)}a.stroke()}for(i=0;i<5;i++){j=i/5*Math.PI*2;k=Math.sin(j);m=Math.cos(j);a.beginPath();
a.lineTo(k*d,-m*d);a.lineTo(-k*d,m*d);a.lineTo(m*b-k*e,k*b+m*e);a.lineTo(m*b+k*e,k*b-m*e);a.fill()}}a.restore()};var uc=5,Qb=0.2,dd=0.5;Ka.t(D);Ka.prototype.e=function(a){var b=this.u().a(),c=this.nc/uc;a.fillStyle="black";a.beginPath();a.arc(b.x,b.y,(1-c)*Qb,0,Math.PI*2,p);a.fill();a.strokeStyle="black";a.beginPath();a.arc(b.x,b.y,Qb,0,Math.PI*2,p);a.stroke()};Ka.prototype.B=function(a){this.nc-=a;this.nc<=0&&this.w(l);D.prototype.B.call(this,a)};Ka.prototype.ea=K();Ka.prototype.L=function(){for(var a,
b,c,d,e,f=this.a(),h=0;h<100;h++){var i=(a=g.G((d=2*Math.PI,0+(d-0)*Math.random())),b=1+9*Math.random(),c=new g(0,0),c.x=a.x*b,c.y=a.y*b,c);A().position(f).b(i).h(0.1,0.2).D(0,4).I(0.05,0.9).F(1.0E-4,0.001).expand(1,1.2).color(1,0.25,0,1).V(1,0.5,0,1).Da()}for(h=0;h<50;h++){i=g.G((a=2*Math.PI,0+(a-0)*Math.random()));i=(a=new g(0,1),b=(d=0.25+0.75*Math.random(),e=new g(0,0),e.x=i.x*d,e.y=i.y*d,e),c=new g(0,0),c.x=a.x+b.x,c.y=a.y+b.y,c);A().position(f).b(i).h(0.1,0.2).D(1,3).I(0.05,0.9).F(5.0E-4,0.1).expand(1.1,
1.3).color(0,0,0,1).V(0.5,0.5,0.5,1).pa().ka(-0.4,0)}};var hd=1.5,fd=0.76,gd=0.76;oa.t(u);oa.prototype.Ie=function(a,b){var c=b.split(" "),d=[],e="";a.font="12px sans serif";for(var f=this.Ke*y,h=0,i=0;i<c.length;++i){var j=c[i];h=a.measureText(e+j).width;if(h<f)e+=" "+j;else{e.length>0&&d.push(e);e=j}if(i==c.length-1){d.push(e);break}}return d};oa.prototype.u=L("M");oa.prototype.ba=N(p);oa.prototype.B=function(a){this.$+=a;this.Wb=p;u.prototype.B.call(this,a)};oa.prototype.Z=function(){this.Wb=l};
oa.prototype.e=function(a){if(this.Mb===o)this.Mb=this.Ie(a,this.text);var b=this.a();a.save();a.textAlign="center";a.scale(1/y,-1/y);a.save();a.font="bold 34px sans-serif";a.lineWidth=1;a.fillStyle="yellow";a.strokeStyle="black";a.translate(b.x*y,-b.y*y+12);var c=this.$-Math.floor(this.$);c=Math.cos(c*2*Math.PI)/16+1;a.scale(c,c);a.fillText("?",0,0);a.strokeText("?",0,0);a.restore();this.Wb&&Zb(a,this.Mb,b.x*y,-(b.y+0.5)*y-15*this.Mb.length/2,13);a.restore()};La.t(u);La.prototype.u=L("N");var Ma=
0.15,jd=0,ye=Ma*0.5;Rb.prototype.B=function(a,b){var c=this.za.x-b.x*y,d=this.za.y-b.y*y,e=Math.min(1,Math.sqrt(c*c+d*d)/ye);for(c=Math.atan2(d,c)-this.k;c<-Math.PI;)c+=Math.PI*2;for(;c>Math.PI;)c-=Math.PI*2;this.k+=600*(Math.random()-0.5)*a*(1-e*0.8)+(Math.PI-Math.abs(c))/Math.PI*e*(c>0?-2:2);this.k-=Math.floor(this.k/(Math.PI*2))*Math.PI*2;this.za.x+=600*Math.cos(this.k)*a;this.za.y+=600*Math.sin(this.k)*a;this.Ma.push(new g(this.za.x,this.za.y));this.Ma.length>15&&this.Ma.shift()};Rb.prototype.e=
function(a){for(var b=1;b<this.Ma.length;b++){var c=this.Ma[b-1],d=this.Ma[b];a.strokeStyle="rgba(0, 0, 0, "+(b/this.Ma.length).toFixed(3)+")";a.beginPath();a.moveTo(c.x/y,c.y/y);a.lineTo(d.x/y,d.y/y);a.stroke()}};pa.t(La);pa.prototype.move=function(a){var b,c,d,e,f;this.dd=p;if(this.$c){this.target.l&&this.w(l);h=(b=(d=this.target.a(),e=new g(0,0.45),f=new g(0,0),f.x=d.x+e.x,f.y=d.y+e.y,f),c=this.a(),b.x-=c.x,b.y-=c.y,b);if(this.target.crouchKey&&this.target.Bb()){h.y-=0.25;if(this.target.ja)h.x+=
0.15;else h.x-=0.15}this.N.moveBy(h)}else{if(this.target.l)return new g(0,0);var h=(b=this.target.a(),c=this.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d);if(h.x*h.x+h.y*h.y<36&&!r.Ia(this.a(),this.target.a(),n.j)){h.y+=0.45;if(h.x*h.x+h.y*h.y>3*a*3*a*3){this.dd=l;b=Math.sqrt(h.x*h.x+h.y*h.y);h.x/=b;h.y/=b;h=(b=3*a,c=new g(0,0),c.x=h.x*b,c.y=h.y*b,c)}else this.$c=l;return h}}return new g(0,0)};pa.prototype.ea=K();pa.prototype.L=function(){var a,b,c,d;n.ra(Va);var e=this.a(),f=(a=g.G((d=2*Math.PI,0+
(d-0)*Math.random())),b=0+0.05*Math.random(),c=new g(0,0),c.x=a.x*b,c.y=a.y*b,c);f=A().position(e).b(f).h(Ma).D(3).I(0.5).F(0.01).pa().ka(5);this.target==n.i?f.color(1,0,0,1):f.color(0,0,1,1);for(d=0;d<50;++d){e=(a=2*Math.PI,0+(a-0)*Math.random());f=(a=g.G(e),b=3+2*Math.random(),c=new g(0,0),c.x=a.x*b,c.y=a.y*b,c);A().position(this.a()).b(f).k(e).h(0.05).D(3).I(0.5).F(0.01).Db().color(0,0,0,1)}};pa.prototype.Z=function(a){if(a===this.target)a.Yd();else a.b.y<0&&a.a().y>this.a().y&&this.w(l)};pa.prototype.H=
function(a){for(var b=this.a(),c=0;c<this.Za.length;c++)this.Za[c].B(a,b)};pa.prototype.e=function(a){var b=this.a();a.strokeStyle="black";for(var c=0;c<this.Za.length;c++)this.Za[c].e(a);a.fillStyle=this.target==n.i?"red":"blue";a.beginPath();a.arc(b.x,b.y,Ma*0.75,0,Math.PI*2,p);a.fill();a.stroke()};var Sb=0.15,vc=5,ld=0;Xa.t(D);Xa.prototype.move=function(a){var b,c;return b=this.b,c=new g(0,0),c.x=b.x*a,c.y=b.y*a,c};Xa.prototype.ea=function(){var a,b;if(this.wc<=0){this.w(l);for(var c=this.a(),
d=0;d<20;++d){var e=(a=2*Math.PI,0+(a-0)*Math.random()),f=g.G(e);f=(a=0.5+4.5*Math.random(),b=new g(0,0),b.x=f.x*a,b.y=f.y*a,b);A().position(c).b(f).k(e).h(0.1).D(1).I(1).F(0.01).ka(0).color(1,1,1,1).Db()}}else--this.wc};Xa.prototype.e=function(a){var b,c,d,e,f=(b=(c=this.b,d=new g(0,0),e=Math.sqrt(c.x*c.x+c.y*c.y),d.x=c.x/e,d.y=c.y/e,d),b.x*=Sb,b.y*=Sb,b);d=new M((b=this.a(),c=new g(0,0),c.x=b.x-f.x,c.y=b.y-f.y,c),(b=this.a(),c=new g(0,0),c.x=b.x+f.x,c.y=b.y+f.y,c));a.lineWidth=0.07;a.strokeStyle=
"white";d.e(a);a.lineWidth=0.02};var wc=0.1,xc=7;Ya.t(D);Ya.prototype.Z=function(a){var b,c;if(!this.l){var d=(b=this.b,c=new g(0,0),c.x=b.x*0.75,c.y=b.y*0.75,c);a.Kd(d)}this.w(l)};Ya.prototype.L=function(){for(var a,b,c,d,e,f=this.a(),h=0;h<5;++h){var i=g.G((a=2*Math.PI,0+(a-0)*Math.random()));i=(a=this.b,b=(d=0.1+0.9*Math.random(),e=new g(0,0),e.x=i.x*d,e.y=i.y*d,e),c=new g(0,0),c.x=a.x+b.x,c.y=a.y+b.y,c);A().position(f).b(i).h(0.01,0.1).D(0,4).I(0.05,0.9).F(5.0E-4,0.005).expand(1,1.2).color(0.9,
0.9,0,1).V(1,1,0,1).pa()}u.prototype.L.call(this)};Ya.prototype.e=function(a){var b=this.a();a.strokeStyle="black";a.fillStyle="yellow";a.beginPath();a.arc(b.x,b.y,wc,0,2*Math.PI,p);a.fill();a.stroke()};X.t(u);X.prototype.u=L("N");var yc=0.5;xa.t(X);xa.prototype.ba=N(p);xa.prototype.Pa=N(l);xa.prototype.move=function(a){var b,c,d;if(!this.target)return new g(0,0);var e=(b=this.target.a(),c=this.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d);this.U=fb(this.U,e.atan2(),7);d=7*a;this.b.x+=d*Math.cos(this.U);
this.b.y+=d*Math.sin(this.U);if((b=this.b,b.x*b.x+b.y*b.y)>0.7*0.7){b=this.b;c=Math.sqrt(b.x*b.x+b.y*b.y);b.x/=c;b.y/=c;b=this.b;b.x*=0.7;b.y*=0.7}return b=this.b,c=new g(0,0),c.x=b.x*a,c.y=b.y*a,c};xa.prototype.H=function(){var a,b,c,d,e,f=g.G((a=2*Math.PI,0+(a-0)*Math.random()));f=(a=this.a(),b=(d=0+(yc-0)*Math.random(),e=new g(0,0),e.x=f.x*d,e.y=f.y*d,e),c=new g(0,0),c.x=a.x+b.x,c.y=a.y+b.y,c);e=this.target===n.i?0.4:0;var h=this.target===n.r?0.3:0;this.Kb=(a=(c=this.Kb,d=new g(0,0),d.x=c.x*0.95,
d.y=c.y*0.95,d),b=(c=this.b,d=new g(0,0),d.x=c.x*0.05,d.y=c.y*0.05,d),a.x+=b.x,a.y+=b.y,a);A().position(f).b((a=this.Kb,b=new g(0.1,0.1),c=new g(0,0),c.x=a.x-b.x,c.y=a.y-b.y,c),(a=this.Kb,b=new g(0.1,0.1),c=new g(0,0),c.x=a.x+b.x,c.y=a.y+b.y,c)).h(0.01,0.1).D(0,4).I(0.05,0.9).F(0.01,0.5).expand(1,1.2).color(0.2+e,0.2,0.2+h,1).V(0.1+e,0.1,0.1+h,1).pa().ka(-0.4,0)};xa.prototype.e=K();var pd=0.3,qd=0.5,ze=2*Math.PI;ya.t(X);ya.prototype.Pa=N(l);ya.prototype.yc=function(a){var b,c,d;if(a.l)return new g(0,
0);a=(b=a.a(),c=this.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d);if(a.x*a.x+a.y*a.y>100)return new g(0,0);b=Math.sqrt(a.x*a.x+a.y*a.y);a.x/=b;a.y/=b;return a};ya.prototype.move=function(a){var b,c,d,e,f,h,i=n.i,j=n.r,k=this.yc(i),m=this.yc(j);k=(b=(d=new g(0,0),d.x=k.x+m.x,d.y=k.y+m.y,d),c=new g(0,0),c.x=b.x*2,c.y=b.y*2,c);m=this.fa(k,a);b=this.b;c=Math.pow(0.547821,a);b.x*=c;b.y*=c;var q=this.a(),s=this.o.k,t=s;if(!i.l&&j.l)t=(b=i.a(),c=new g(0,0),c.x=b.x-q.x,c.y=b.y-q.y,c).atan2()+Math.PI;else if(i.l&&
!j.l)t=(b=j.a(),c=new g(0,0),c.x=b.x-q.x,c.y=b.y-q.y,c).atan2();else if(!i.l&&!j.l){i=(b=(d=(f=i.a(),h=new g(0,0),h.x=f.x-q.x,h.y=f.y-q.y,h),e=d.x,d.x=d.y,d.y=-e,d),c=(d=j.a(),e=new g(0,0),e.x=d.x-q.x,e.y=d.y-q.y,e),b.x*c.x+b.y*c.y)<0;t=k.atan2()-Math.PI*0.5+Math.PI*i}this.o.k=fb(s,t,ze*a);return m};ya.prototype.H=function(){var a=this.a();this.o.n=new g(a.x,a.y)};ya.prototype.e=function(a){this.o.e(a)};var ja=0,Ub=1,tb=2,sd=0.3,td=0.4,Tb=0;qa.t(X);qa.prototype.Pa=N(l);qa.prototype.wb=function(a){var b,
c,d,e,f,h,i,j;return b=(c=(e=(h=new g(0,0),i=Math.sqrt(a.x*a.x+a.y*a.y),h.x=a.x/i,h.y=a.y/i,h),f=(h=this.b,i=3/14,j=new g(0,0),j.x=h.x*i,j.y=h.y*i,j),e.x-=f.x,e.y-=f.y,e),d=Math.sqrt(c.x*c.x+c.y*c.y),c.x/=d,c.y/=d,c),b.x*=14,b.y*=14,b};qa.prototype.Xa=function(a,b){if(a.l)return p;var c=b<64;c&=!r.Ia(this.a(),a.a(),n.j);return c};qa.prototype.move=function(a){var b,c,d,e,f,h,i=(b=n.i.a(),c=this.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d),j=(b=n.r.a(),c=this.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,
d),k=(b=(d=n.i.b,e=20*a,f=new g(0,0),f.x=d.x*e,f.y=d.y*e,f),c=new g(0,0),c.x=i.x+b.x,c.y=i.y+b.y,c),m=(b=(d=n.r.b,e=20*a,f=new g(0,0),f.x=d.x*e,f.y=d.y*e,f),c=new g(0,0),c.x=j.x+b.x,c.y=j.y+b.y,c),q=i.x*i.x+i.y*i.y,s=j.x*j.x+j.y*j.y,t=this.Xa(n.i,q),w=this.Xa(n.r,s);if(t)if(w)if((b=this.b,i.x*b.x+i.y*b.y)*(b=this.b,j.x*b.x+j.y*b.y)>=0){this.R=(b=(d=(f=new g(0,0),h=Math.sqrt(i.x*i.x+i.y*i.y),f.x=i.x/h,f.y=i.y/h,f),e=(f=new g(0,0),h=Math.sqrt(j.x*j.x+j.y*j.y),f.x=j.x/h,f.y=j.y/h,f),d.x+=e.x,d.y+=e.y,
d),c=-1.5,b.x*=c,b.y*=c,b);this.target=o;this.z=3}else if(q<s){this.R=this.wb(k);this.target=n.i;this.z=1}else{this.R=this.wb(m);this.target=n.r;this.z=2}else{this.R=this.wb(k);this.target=n.i;this.z=1}else if(w){this.R=this.wb(m);this.target=n.r;this.z=2}else{this.R.x=this.R.y=0;this.target=o;this.z=Tb}b=this.b;c=Math.pow(0.366032,a);b.x*=c;b.y*=c;return this.fa(this.R,a)};qa.prototype.H=function(a){var b,c,d=this.a();this.d[ja].n=d;if(this.target){var e=this.d[ja].k;d=(b=this.target.a(),c=new g(0,
0),c.x=b.x-d.x,c.y=b.y-d.y,c).atan2()-Math.PI/2;this.d[ja].k=fb(e,d,Math.PI*a)}this.Cb=fb(this.Cb,this.target?-0.2:0,0.4*a);this.d[Ub].k=this.Cb;this.d[tb].k=this.Cb};qa.prototype.e=function(a){var b,c,d,e;a.fillStyle=this.target==n.i?"red":"blue";a.strokeStyle="black";if(this.z!=Tb){var f=this.d[ja].k+Math.PI/2,h=g.G(f),i=(b=this.a(),c=(e=new g(0,0),e.x=h.x*0.2,e.y=h.y*0.2,e),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d);if(this.z==1){a.fillStyle="red";a.beginPath();a.arc(i.x,i.y,0.1,0,2*Math.PI,p);a.fill()}else if(this.z==
2){a.fillStyle="blue";a.beginPath();a.arc(i.x,i.y,0.1,0,2*Math.PI,p);a.fill()}else{a.fillStyle="red";a.beginPath();a.arc(i.x,i.y,0.1,f,f+Math.PI,p);a.fill();a.fillStyle="blue";a.beginPath();a.arc(i.x,i.y,0.1,f+Math.PI,f+2*Math.PI,p);a.fill();a.beginPath();a.moveTo(i.x-h.x*0.1,i.y-h.y*0.1);a.lineTo(i.x+h.x*0.1,i.y+h.y*0.1);a.stroke()}}this.d[ja].e(a)};var Za=0,$a=1,ub=2.5,Y=0.15,ud=1,vd=0.3;aa.t(X);aa.prototype.xc=function(a){var b,c,d;if(!this.target.l){var e=(b=this.target.a(),c=this.a(),d=new g(0,
0),d.x=b.x-c.x,d.y=b.y-c.y,d).atan2();this.U=fb(this.U,e,this.se*a)}};aa.prototype.move=function(a){var b,c;if(this.Fd<=0){this.xc(a);this.b=new g(ub*Math.cos(this.U),ub*Math.sin(this.U))}else this.Fd-=a;return b=this.b,c=new g(0,0),c.x=b.x*a,c.y=b.y*a,c};aa.prototype.H=function(a){var b,c,d,e,f,h,i=this.a();this.d[Za].n=i;this.d[$a].n=i;this.d[Za].k=this.U;this.d[$a].k=this.U;i=(b=(d=(e=this.b,f=new g(0,0),h=Math.sqrt(e.x*e.x+e.y*e.y),f.x=e.x/h,f.y=e.y/h,f),d.x*=Y,d.y*=Y,d),c=new g(0,0),c.x=i.x-
b.x,c.y=i.y-b.y,c);for(this.oc-=a;this.oc<=0&&!this.l;){a=g.G((b=2*Math.PI,0+(b-0)*Math.random()));a=(b=(d=0+2*Math.random(),e=new g(0,0),e.x=a.x*d,e.y=a.y*d,e),c=(d=this.b,e=new g(0,0),e.x=d.x*3,e.y=d.y*3,e),b.x-=c.x,b.y-=c.y,b);A().position(i).b(a).h(0.1,0.15).D(1).F(1.0E-6,1.0E-5).expand(1,1.2).color(1,0.5,0,1).V(1,1,0,1).Da();a=g.G((b=2*Math.PI,0+(b-0)*Math.random()));a=(b=(d=0.25+0.75*Math.random(),e=new g(0,0),e.x=a.x*d,e.y=a.y*d,e),c=this.b,b.x-=c.x,b.y-=c.y,b);A().position(i).b(a).h(0.05,
0.1).D(1).I(0.05,0.9).F(5.0E-4,0.001).expand(1.2,1.4).color(0,0,0,0.25).V(0.25,0.25,0.25,0.75).pa().ka(-0.4,0);this.oc+=0.03}};aa.prototype.ea=function(){this.w(l)};aa.prototype.Z=function(a){this.w(l);a.w(l)};aa.prototype.L=function(){for(var a,b,c=this.a(),d=0;d<50;++d){var e=g.G((a=2*Math.PI,0+(a-0)*Math.random()));e=(a=0.5+16.5*Math.random(),b=new g(0,0),b.x=e.x*a,b.y=e.y*a,b);A().position(c).b(e).h(0.02,0.15).D(0,4).I(0.05,0.9).F(1.0E-5,1.0E-4).expand(1,1.2).color(1,0.5,0,1).V(1,1,0,1).Da()}};
aa.prototype.e=function(a){this.d[this.target==n.i?Za:$a].e(a)};var vb=4,wd=3,yd=2;ab.t(aa);ab.prototype.move=function(a){var b,c;this.U=this.b.atan2();this.xc(a);this.b=new g(vb*Math.cos(this.U),vb*Math.sin(this.U));return b=this.b,c=new g(0,0),c.x=b.x*a,c.y=b.y*a,c};ab.prototype.ea=function(){--this.Uc;if(this.Uc<=0)this.w(l);else this.target=n.Ab(this.target)};ab.prototype.w=function(a){G.prototype.w.call(this,a);a&&this.gd!==o&&this.gd.Ee()};var Ad=0.3;za.t(La);za.prototype.Pa=function(){return this.xb?
p:l};za.prototype.move=function(a){var b,c,d;b=this.b;c=Math.pow(0.818566804688,a);b.x*=c;b.y*=c;if(!this.target||this.target.l){this.xb=p;return this.fa((b=this.b,c=-0.8,d=new g(0,0),d.x=b.x*c,d.y=b.y*c,d),a)}var e=(b=this.target.a(),c=this.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d);if(e.x*e.x+e.y*e.y>100){this.xb=p;return this.fa((b=this.b,c=-0.8,d=new g(0,0),d.x=b.x*c,d.y=b.y*c,d),a)}this.xb=l;b=Math.sqrt(e.x*e.x+e.y*e.y);e.x/=b;e.y/=b;return this.fa((b=new g(0,0),b.x=e.x*6,b.y=e.y*6,b),a)};za.prototype.L=
function(){n.ra(Va)};za.prototype.H=function(){var a,b,c=this.a();this.o.n=c;if(!this.target.l)this.o.k=(a=this.target.a(),b=new g(0,0),b.x=a.x-c.x,b.y=a.y-c.y,b).atan2()-Math.PI/2};za.prototype.e=function(a){a.fillStyle=this.target==n.i?"red":"blue";a.strokeStyle="black";this.o.e(a)};H.t(u);H.prototype.u=L("M");H.prototype.ke=function(){return 1-this.tb/this.Dd};H.prototype.B=function(a){this.tb-=a;if(this.tb<=0)if(this.Oa())this.tb+=this.Dd;else this.tb=0;u.prototype.B.call(this,a)};H.prototype.Z=
K();H.prototype.Oa=function(){throw"SpawningEnemy.spawn() unimplemented";};var Cd=0.4,wb=0.4,bb=2,Bc=1,Dd=1;ra.t(H);ra.prototype.move=function(a){var b,c;return b=this.b,c=new g(0,0),c.x=b.x*a,c.y=b.y*a,c};ra.prototype.Z=function(a){var b,c,d;if((b=a.a(),c=this.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d).y>wb-0.05){a.ma(new g(a.b.x,6));this.w(l)}else a.ya?this.w(l):a.w(l)};ra.prototype.Oa=function(){var a=new g(this.M.m.x+this.M.$b()*0.5,this.M.m.y);n.Ea(new sb(a,new g(0,Math.min(this.b.y,-0.3))),
a);return l};ra.prototype.H=K();ra.prototype.L=function(){sb.prototype.L.call(this);n.ra(Va)};ra.prototype.e=function(a){var b=this.a();a.strokeStyle="black";a.beginPath();a.moveTo(b.x-0.25,b.y-0.2);a.lineTo(b.x-0.25,b.y-0.1);a.lineTo(b.x-0.1,b.y+0.05);a.lineTo(b.x+0.1,b.y+0.05);a.lineTo(b.x+0.25,b.y-0.1);a.lineTo(b.x+0.25,b.y-0.2);a.arc(b.x,b.y-wb*0.5,Ob,0,Math.PI,p);a.lineTo(b.x-0.25,b.y-0.2);a.moveTo(b.x-0.1,b.y+0.05);a.lineTo(b.x-0.2,b.y+0.15);a.moveTo(b.x+0.1,b.y+0.05);a.lineTo(b.x+0.2,b.y+0.15);
a.stroke();a.fillStyle="black";a.beginPath();a.arc(b.x,b.y-wb*0.5,Ob*this.ke(),0,2*Math.PI,p);a.fill()};var Fd=0.5,Gd=0.5,Hd=1;Aa.t(H);Aa.prototype.ba=N(p);Aa.prototype.Ee=function(){this.Tb=l};Aa.prototype.Oa=function(){var a,b,c;if(this.Tb&&!this.target.l){var d=(a=this.target.a(),b=this.a(),c=new g(0,0),c.x=a.x-b.x,c.y=a.y-b.y,c);if(Math.sqrt(d.x*d.x+d.y*d.y)<8)if(!r.Ia(this.a(),this.target.a(),n.j)){n.Ea(new ab(this.a(),this.target,d.atan2(),this),this.a());this.Tb=p;return l}}return p};Aa.prototype.H=
function(){var a,b,c=this.a();if(!this.target.l)this.o.k=(a=this.target.a(),b=new g(0,0),b.x=c.x-a.x,b.y=c.y-a.y,b).atan2();this.o.n=c};Aa.prototype.e=function(a){this.o.e(a)};var Jd=0.5,Kd=0.5,Cc=1.2;Na.t(H);Na.prototype.ba=N(p);Na.prototype.Oa=function(){var a,b,c,d,e,f=(a=(c=this.target.a(),d=new g(0,3),e=new g(0,0),e.x=c.x+d.x,e.y=c.y+d.y,e),b=this.a(),a.x-=b.x,a.y-=b.y,a);a=f.atan2();b=Math.sqrt(f.x*f.x+f.y*f.y);if(!this.target.l&&b<8)if(!r.Ia(this.a(),this.target.a(),n.j)){this.rb=b*0.075;n.Ea(new Ka(this.a(),
a,Math.sqrt(f.x*f.x+f.y*f.y)),this.a());return l}return p};Na.prototype.H=function(a){var b,c,d,e,f=this.a();if(!this.target.l)this.o.k=(b=(c=this.target.a(),d=new g(0,3),e=new g(0,0),e.x=c.x+d.x,e.y=c.y+d.y,e),b.x-=f.x,b.y-=f.y,b).atan2()+Math.PI/2;this.o.n=f;if(this.wa<this.rb){this.wa+=5*a;if(this.wa>=this.rb){this.wa=this.rb;this.rb=0}}else{this.wa-=0.5*a;if(this.wa<=0)this.wa=0}this.o.nb=new g(0,this.wa)};Na.prototype.e=function(a){a.fillStyle=this.target==n.i?"red":"blue";a.strokeStyle="black";
this.o.e(a)};var Md=0.4,Nd=0.4,Dc=0.2,Z=3,xb=0,cb=1;Oa.t(H);Oa.prototype.ba=N(p);Oa.prototype.Oa=function(){n.Ea(new Ya(this.a(),this.direction),this.a());return l};Oa.prototype.H=function(a){var b,c;this.Hb+=a*(0.5/Dc);a=this.Hb*(2*Math.PI/Z);var d=this.direction-Math.PI/2,e=(b=g.G(d),c=new g(0,0),c.x=b.x*0.2,c.y=b.y*0.2,c);c=this.a();this.d[xb].k=d+a;this.d[cb].k=d-a;this.d[xb].n=(b=new g(0,0),b.x=c.x-e.x,b.y=c.y-e.y,b);this.d[cb].n=(b=new g(0,0),b.x=c.x+e.x,b.y=c.y+e.y,b);Z&1||(this.d[cb].k+=Math.PI/
Z)};Oa.prototype.e=function(a){var b,c,d,e,f;this.d[xb].e(a);this.d[cb].e(a);var h=this.Hb*(2*Math.PI/Z),i=this.direction-Math.PI/2,j=this.a();i=(b=g.G(i),c=new g(0,0),c.x=b.x*0.2,c.y=b.y*0.2,c);a.fillStyle="yellow";a.strokeStyle="black";for(var k=-1;k<=1;k+=2)for(var m=0;m<Z;m++){var q=m*(2*Math.PI/Z)-k*h,s=(this.Hb-m*k)/Z+(k==1)*0.5;if(k==1&&!(Z&1)){q+=Math.PI/Z;s-=0.5/Z}s-=Math.floor(s);q=(b=(d=(f=new g(0,0),f.x=i.x*k,f.y=i.y*k,f),e=new g(0,0),e.x=j.x+d.x,e.y=j.y+d.y,e),c=i.rotate(q),b.x+=c.x,
b.y+=c.y,b);a.beginPath();a.arc(q.x,q.y,0.1*s,0,2*Math.PI,p);a.fill();a.stroke()}};var Pd=0.5,Qd=0.5,Rd=1.25;Ba.t(H);Ba.prototype.ba=N(p);Ba.prototype.rc=function(a){return(a.x<0?0:1)+(a.y<0?0:2)};Ba.prototype.Oa=function(){for(var a,b,c,d=0;d<4;++d)this.ac[d]=p;var e=p;for(d=0;d<2;++d){var f=n.Zb(d),h=this.rc((a=f.a(),b=this.a(),c=new g(0,0),c.x=a.x-b.x,c.y=a.y-b.y,c)),i=(a=f.a(),b=this.g[h],c=new g(0,0),c.x=a.x-b.x,c.y=a.y-b.y,c);if(!f.l&&i.x*i.x+i.y*i.y<64&&!r.Ia(this.g[h],f.a(),n.j))if(!this.ac[h]){n.Ea(new Xa(this.g[h],
i.atan2()),this.g[h]);e=this.ac[h]=l}}return e};Ba.prototype.H=function(a){var b,c,d=this.a(),e=this.g[this.rc((b=n.i.a(),c=new g(0,0),c.x=b.x-d.x,c.y=b.y-d.y,c))];d=this.g[this.rc((b=n.r.a(),c=new g(0,0),c.x=b.x-d.x,c.y=b.y-d.y,c))];a=4*a;this.Ca.uc(e,a);this.Fa.uc(d,a)};Ba.prototype.e=function(a){var b,c,d;if(this.Ca.eq(this.Fa)&&!n.i.l&&!n.r.l){var e=(b=this.Ca,c=this.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d).atan2();a.fillStyle="rgb(205, 0, 0)";a.beginPath();a.arc(this.Ca.x,this.Ca.y,0.1,e,
e+Math.PI,p);a.fill();a.fillStyle="rgb(0, 0, 255)";a.beginPath();a.arc(this.Fa.x,this.Fa.y,0.1,e+Math.PI,e+2*Math.PI,p);a.fill()}else{if(!n.i.l){a.fillStyle="rgb(205, 0, 0)";a.beginPath();a.arc(this.Ca.x,this.Ca.y,0.1,0,2*Math.PI,p);a.fill()}if(!n.r.l){a.fillStyle="rgb(0, 0, 255)";a.beginPath();a.arc(this.Fa.x,this.Fa.y,0.1,0,2*Math.PI,p);a.fill()}}a.strokeStyle="black";a.beginPath();a.moveTo(this.g[0].x,this.g[0].y+0.1);a.lineTo(this.g[1].x,this.g[1].y+0.1);a.moveTo(this.g[0].x,this.g[0].y-0.1);
a.lineTo(this.g[1].x,this.g[1].y-0.1);a.moveTo(this.g[2].x,this.g[2].y-0.1);a.lineTo(this.g[3].x,this.g[3].y-0.1);a.moveTo(this.g[2].x,this.g[2].y+0.1);a.lineTo(this.g[3].x,this.g[3].y+0.1);a.moveTo(this.g[0].x+0.1,this.g[0].y);a.lineTo(this.g[2].x+0.1,this.g[2].y);a.moveTo(this.g[0].x-0.1,this.g[0].y);a.lineTo(this.g[2].x-0.1,this.g[2].y);a.moveTo(this.g[1].x-0.1,this.g[1].y);a.lineTo(this.g[3].x-0.1,this.g[3].y);a.moveTo(this.g[1].x+0.1,this.g[1].y);a.lineTo(this.g[3].x+0.1,this.g[3].y);a.stroke();
a.beginPath();a.arc(this.g[0].x,this.g[0].y,0.1,0,2*Math.PI,p);a.stroke();a.beginPath();a.arc(this.g[1].x,this.g[1].y,0.1,0,2*Math.PI,p);a.stroke();a.beginPath();a.arc(this.g[2].x,this.g[2].y,0.1,0,2*Math.PI,p);a.stroke();a.beginPath();a.arc(this.g[3].x,this.g[3].y,0.1,0,2*Math.PI,p);a.stroke()};var Ec=0.2;Ca.t(u);Ca.prototype.u=L("N");Ca.prototype.ba=N(p);Ca.prototype.H=function(a){this.d[0].n=this.a();this.d[0].k-=a*(25*Math.PI/180);this.d[1].k+=a*(65*Math.PI/180);this.d[2].k+=a*(15*Math.PI/180)};
Ca.prototype.e=function(a){this.d[0].e(a)};var Ud=0.2,db=0,Wb=1,Xb=2;Pa.t(D);Pa.prototype.move=function(a){if(this.bd)return D.prototype.move.call(this,a);else if(this.target!==o&&!this.target.l){var b=this.target.a(),c=this.a();if(Math.abs(b.x-c.x)<0.1&&b.y<c.y)if(!r.Ia(c,b,n.j)){this.bd=l;return D.prototype.move.call(this,a)}}return new g(0,0)};Pa.prototype.H=function(){var a=this.b.y*-0.25;if(a>1)a=1;var b=this.a();this.d[db].n=new g(b.x,b.y+0.1-0.2*a);a=a*Math.PI/2;this.d[Wb].k=Math.PI-a;this.d[Xb].k=
a-Math.PI/2};Pa.prototype.L=function(){var a,b,c,d;n.ra(Va);for(var e=this.target===n.i?0.8:0,f=this.target===n.r?1:0,h=this.a(),i=0;i<15;++i){var j=(a=g.G((d=2*Math.PI,0+(d-0)*Math.random())),b=5+5*Math.random(),c=new g(0,0),c.x=a.x*b,c.y=a.y*b,c);A().position(h).b(j).h(0.2).D(3).F(0.01).I(0.5).color(e,0,f,1).Da()}};Pa.prototype.e=function(a){a.fillStyle=this.target===n.i?"red":"blue";this.d[db].e(a)};ba.t(u);ba.prototype.u=L("N");ba.prototype.move=function(a){var b,c;return b=this.b,c=new g(0,0),
c.x=b.x*a,c.y=b.y*a,c};var Yb=0.45,Wd=0.2,Vd=1;ka.t(ba);ka.prototype.td=function(a){if(a.l)return p;var b=Math.abs(a.u().T().m.y-this.N.T().m.y)<0.01;a=a.a().x-this.a().x;return b=b&&Math.abs(a)<1&&this.b.x*a>-0.01};ka.prototype.move=function(a){var b,c;if(this.Bb()){if(this.td(n.i)||this.td(n.r))this.b.x*=-1;return b=this.b,c=new g(0,0),c.x=b.x*a,c.y=b.y*a,c}else return this.fa(new g(0,-6),a)};ka.prototype.ea=function(a){var b,c,d,e,f;if(B.qa(a.q)===ia){a=this.b.ob(a.q);var h=(b=this.b,c=new g(0,
0),c.x=b.x-a.x,c.y=b.y-a.y,c);this.b=(b=(d=(e=new g(0,0),f=Math.sqrt(h.x*h.x+h.y*h.y),e.x=h.x/f,e.y=h.y/f,e),d.x*=yb,d.y*=yb,d),c=(d=new g(0,0),d.x=a.x*0.1,d.y=a.y*0.1,d),b.x+=c.x,b.y+=c.y,b)}};ka.prototype.Z=function(){this.Id.moveTo(this.N.a());r.rd(this.Id).length===0&&this.w(l)};ka.prototype.w=function(a){this.body.w(a);G.prototype.w.call(this,a)};ka.prototype.L=function(){var a,b;n.ra(Va);for(var c=this.a(),d=0;d<16;++d){var e=g.G((a=2*Math.PI,0+(a-0)*Math.random()));e=(a=0.5+4.5*Math.random(),
b=new g(0,0),b.x=e.x*a,b.y=e.y*a,b);var f=(a=2*Math.PI,0+(a-0)*Math.random()),h=(a=-Math.PI,b=Math.PI,a+(b-a)*Math.random());A().position(c).b(e).h(0.25).D(3).I(0.5).F(0.01).Db().k(f).ga(h).color(0,0,0,1)}};ka.prototype.e=K();var Yd=0.3;Da.t(X);Da.prototype.move=function(a){var b,c,d;if(this.target.l){this.b.x=this.b.y=0;return b=this.b,c=new g(0,0),c.x=b.x*a,c.y=b.y*a,c}else{var e=(b=this.target.a(),c=this.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d),f={},h=r.$a(this,5,{},f,n.j);if(h<0.001)return this.fa(new g(0,
0),a);this.R=(b=new g(0,0),c=Math.sqrt(e.x*e.x+e.y*e.y),b.x=e.x/c,b.y=e.y/c,b);if(h<Number.POSITIVE_INFINITY){e=(b=f.c,c=this.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d);d=(b=-1/(h*h),c=new g(0,0),c.x=e.x*b,c.y=e.y*b,c);b=this.R;b.x+=d.x;b.y+=d.y}b=this.R;c=Math.sqrt(b.x*b.x+b.y*b.y);b.x/=c;b.y/=c;b=this.R;b.x*=3.3;b.y*=3.3;b=this.b;c=Math.pow(0.366032,a);b.x*=c;b.y*=c;return this.fa(this.R,a)}};Da.prototype.ea=function(){this.w(l)};Da.prototype.L=function(){var a,b;n.ra(Va);for(var c=this.a(),d=
0;d<50;++d){var e=g.G((a=2*Math.PI,0+(a-0)*Math.random()));e=(a=0.5+16.5*Math.random(),b=new g(0,0),b.x=e.x*a,b.y=e.y*a,b);A().position(c).b(e).h(0.02,0.15).D(0,4).I(0.05,0.9).F(1.0E-6,1.0E-5).expand(1,1.2).color(1,0.3,0,1).V(1,0.1,0,1).Da()}};Da.prototype.H=function(a){var b,c;this.o.n=this.a();this.ga=(this.ga+(b=-Math.PI,c=Math.PI,b+(c-b)*Math.random()))*0.5;this.o.k+=this.ga*a};Da.prototype.e=function(a){a.fillStyle=this.target==n.i?"red":"blue";a.strokeStyle="black";this.o.e(a)};var zb=0.25;
eb.t(ba);eb.prototype.move=function(a){var b,c,d,e,f={};if(r.$a(this,2,{},f,n.j)<Number.POSITIVE_INFINITY){f=(b=this.a(),c=f.c,d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d);var h=(b=new g(0,0),b.x=f.y,b.y=-f.x,b);if(this.Mc){this.yb=(b=this.b,b.x*h.x+b.y*h.y)<0?l:p;this.Mc=p}b=this.b=f.x*f.x+f.y*f.y>zb*zb*1.1?this.yb?(b=(d=-1,e=new g(0,0),e.x=h.x*d,e.y=h.y*d,e),c=(d=new g(0,0),d.x=f.x*0.9,d.y=f.y*0.9,d),b.x-=c.x,b.y-=c.y,b):(b=(d=new g(0,0),d.x=f.x*0.9,d.y=f.y*0.9,d),c=new g(0,0),c.x=h.x-b.x,c.y=h.y-b.y,
c):this.yb?(b=(d=-1,e=new g(0,0),e.x=h.x*d,e.y=h.y*d,e),c=(d=new g(0,0),d.x=f.x*0.11,d.y=f.y*0.11,d),b.x+=c.x,b.y+=c.y,b):(b=(d=new g(0,0),d.x=f.x*0.11,d.y=f.y*0.11,d),c=new g(0,0),c.x=h.x+b.x,c.y=h.y+b.y,c);c=Math.sqrt(b.x*b.x+b.y*b.y);b.x/=c;b.y/=c}return b=this.b,c=1*a,d=new g(0,0),d.x=b.x*c,d.y=b.y*c,d};eb.prototype.H=function(a){a=1/zb*a;this.o.n=this.a();if(this.yb)this.o.k+=a;else this.o.k-=a};eb.prototype.e=function(a){this.o.e(a)};var Ea=0.3,ae=1;Qa.t(ba);Qa.prototype.move=function(a){var b,
c,d=this.Bb();if(!this.Tc&&d)if(this.b.x<3){this.b.x=this.Je?3:-3;this.Tc=l}if(d)this.ga=-this.b.x/Ea;this.b.y+=-6*a;return b=this.b,c=new g(0,0),c.x=b.x*a,c.y=b.y*a,c};Qa.prototype.ea=function(a){var b,c,d;if(B.qa(a.q)===ia){a=this.b.ob(a.q);var e=(b=this.b,c=new g(0,0),c.x=b.x-a.x,c.y=b.y-a.y,c);this.b=(b=(d=new g(0,0),d.x=a.x*0.3,d.y=a.y*0.3,d),c=new g(0,0),c.x=e.x+b.x,c.y=e.y+b.y,c);this.ga=-this.b.x/Ea}};Qa.prototype.H=function(a){this.o.n=this.a();this.o.k+=this.ga*a};Qa.prototype.e=function(a){this.a();
this.o.e(a)};var y=50,$b=6,ac=6,oc=1/60;sa.t(function(){this.B=K();this.e=K();this.resize=K();this.Qa=K();this.Ra=K()});sa.prototype.resize=function(a,b){this.width=a;this.height=b;this.zc=new Fc(n.i,n.r,a/y,b/y)};sa.prototype.B=function(a){var b,c,d=0;for(this.Xb+=a;++d<=3&&this.Xb>=0;){this.Xb-=oc;n.B(oc);A.B(oc)}this.Yb=(b=this.Yb,c=1/a,b+(c-b)*0.05);if(!this.ad&&n.ca!=lc){this.ad=l;n.ca==nb&&this.hc&&this.hc()}};sa.prototype.kc=function(a,b,c,d,e){var f=c/2,h=d/2;d=b.x-f;c=b.y-h;f=b.x+f;h=b.y+
h;a.save();a.translate(-b.x,-b.y);e?e.e(a,d,c,f,h):n.j.e(a,d,c,f,h);n.e(a,d,c,f,h);A.e(a);a.restore()};sa.prototype.e=function(a){if(!rc){a.fillStyle="#BFBFBF";a.fillRect(0,0,this.width,this.height)}a.save();a.translate(this.width/2,this.height/2);a.scale(y,-y);a.lineWidth=1/y;this.zc.e(a,this);a.restore();if(n.ca===nb){a.save();Zb(a,[this.fd?"Congratulations, you beat the last level in this set!\tPress SPACE or ESC to return to the level selection menu.":"You won!  Hit SPACE to play the next level or ESC for the level selection menu.",
"","Cogs Collected: "+n.O[nc]+"/"+n.O[Pb]],this.width/2,this.height/2,14);a.restore()}else if(n.ca===Ib){a.save();Zb(a,["You lost.  Hit SPACE to restart, or ESC to select a new level."],this.width/2,this.height/2,14);a.restore()}a.font="10px Arial, sans-serif";a.fillStyle="black";var b=this.Yb.toFixed(0)+" FPS";a.fillText(b,this.width-5-a.measureText(b).width,this.height-5)};sa.prototype.Qa=function(a){var b=ob.Oc(a.which);if(b!=o){if(b.indexOf("a-")==0)n.i[b.substr(2)]=l;else if(b.indexOf("b-")==
0)n.r[b.substr(2)]=l;else n[b]=l;a.preventDefault();a.stopPropagation()}};sa.prototype.Ra=function(a){var b=ob.Oc(a.which);if(b!=o){if(b.indexOf("a-")==0)n.i[b.substr(2)]=p;else if(b.indexOf("b-")==0)n.r[b.substr(2)]=p;else n[b]=p;a.preventDefault();a.stopPropagation()}};ta.prototype.load=function(a,b){if(!this.sa&&this.A==a)b&&b();else if(!(this.sa&&this.A==a)){this.A=a;this.ta=[];this.sa=l;var c=this;Gc("menu","//"+location.host+"/data/"+a+"/",function(d){d=d.levels;for(var e=0;e<d.length;e++){var f=
d[e];c.ta.push(new be(f.html_title,f.title,f.difficulty))}c.sa=p;c.selectedIndex=0;b&&b()})}};ta.prototype.qc=function(){var a=$("#level"+this.selectedIndex);if(a.length>0){$(".level").blur();$(a).focus();a=$("#levelScreen").scrollTop()+$(a).offset().top-475;$("#levelScreen").scrollTop(a)}};ta.prototype.show=function(){if(this.sa){$("#canvas").hide();$("#levelScreen").hide();$("#loadingScreen").show();$("#loadingScreen").html("Loading...")}else{$("#canvas").hide();$("#levelScreen").show();$("#loadingScreen").hide();
var a="<h2>";a+=this.A=="rapt"?"Official Levels":"Levels made by "+Ab(this.A);a+='</h2><div id="levels">';for(var b=o,c=0;c<this.ta.length;c++){var d=this.ta[c],e=["Easy","Medium","Hard","Brutal","Demoralizing"][d.Xd];if(e!=b){b=e;a+='<div class="difficulty">'+e+"</div>"}a+='<a class="level" id="level'+c+'" href="'+Ab(Ra.ie(this.A,d.J))+'">';e=Jb.Rc(this.A,d.J);a+='<img src="/images/'+(e.gotAllCogs?"checkplus":e.complete?"check":"empty")+'.png">';a+=Ab(d.title)+"</a>"}a+="</div>";$("#levelScreen").html(a);
var f=this;$(".level").hover(function(){$(this).focus()});$(".level").focus(function(){f.selectedIndex=this.id.substr(5)});this.qc()}};ta.prototype.bc=function(a,b){if(a===this.A)for(var c=0;c<this.ta.length;c++)if(b===this.ta[c].J)return c;return-1};ta.prototype.cd=function(a,b){return a!==this.A?l:this.bc(a,b)>=this.ta.length-1};ta.prototype.Qa=function(a){if(a.which==38){this.selectedIndex>0&&this.selectedIndex--;this.qc()}else if(a.which==40){this.selectedIndex<this.ta.length-1&&this.selectedIndex++;
this.qc()}};ta.prototype.Ra=K();Fa.prototype.B=function(){var a=new Date,b=(a-this.ec)/1E3;this.ec=a;if(1!=this.jc){this.canvas.width=Math.round(this.width*1);this.canvas.height=Math.round(this.height*1);this.canvas.style.width=this.width+"px";this.canvas.style.height=this.height+"px";this.context.scale(1,1)}if(this.X!=o){b>0&&b<1&&this.X.B(b);this.X.fd=P.cd(this.A,this.J);this.X.e(this.context)}};Fa.prototype.yd=function(){A.reset();this.X=new sa;this.X.resize(this.width,this.height);n.qe(this.ed);
var a=this;this.X.hc=function(){var b=n.O[nc]==n.O[Pb];Jb.He(a.A,a.J,l,Jb.Rc(a.A,a.J).gotAllCogs||b)}};Fa.prototype.load=function(a,b,c){this.A=a;this.J=b;this.sa=l;var d=this;Gc("level","//"+location.host+"/data/"+a+"/"+b+"/",function(e){d.ed=JSON.parse(e.data);d.yd();d.ec=new Date;d.sa=p;c&&c()})};Fa.prototype.show=function(){if(this.sa){$("#canvas").hide();$("#levelScreen").hide();$("#loadingScreen").show();$("#loadingScreen").html("Loading...")}else{$("#canvas").show();$("#levelScreen").hide();
$("#loadingScreen").hide()}};Fa.prototype.Qa=function(a){if(this.X!=o){this.X.Qa(a);if(a.which==32)if(n.ca===Ib)this.yd();else if(n.ca===nb)P.cd(this.A,this.J)?U.Ib(this.A,o):U.Ib(this.A,P.ta[P.bc(this.A,this.J)+1].J)}};Fa.prototype.Ra=function(a){this.X!=o&&this.X.Ra(a)};Ra.prototype.le=function(){if(this.hash!=location.hash){this.vd=this.hash;this.hash=location.hash;var a=/^#\/?([^\/]+)\/([^\/]+)\/?$/.exec(this.hash),b=/^#\/?([^\/]+)\/?$/.exec(this.hash);if(a!=o){this.A=a[1];this.J=a[2]}else{this.A=
b!=o?b[1]:o;this.J=o}return l}return p};Ra.prototype.Ib=function(a,b){var c="#/"+a+"/"+(b?b+"/":"");if(this.vd===c)history.back();else{this.A=a;this.J=b;location.hash=c}};Ra.Ue=function(a){return"#/"+a+"/"};Ra.ie=function(a,b){return"#/"+a+"/"+b+"/"};var Jb=o,U=o,P=o,ca=o,Wa=o;$(document).ready(function(){Hc();ob.load();U=new Ra;P=new ta;ca=new Fa;Jb=new Nb(function(){U.J==o&&P.show()});Ic();setInterval(Ic,1E3/60)});$(".key.changeable").live("mousedown",function(a){Wa=this.id;$(".key.changing").removeClass("changing");
$("#"+Wa).addClass("changing");a.preventDefault();a.stopPropagation()});$(document).keydown(function(a){if(Wa!=o){ob.ua[Wa]=a.which;ob.save();$("#"+Wa).removeClass("changing");a.preventDefault();a.stopPropagation();Wa=o}else if(!a.altKey&&!a.shiftKey&&!a.ctrlKey&&!a.metaKey){P.Qa(a);ca.Qa(a);if(a.which===27)U.Ib(P.A||ca.A,o);if(a.which==38||a.which==40||a.which==32){a.preventDefault();a.stopPropagation()}}});$(document).keyup(function(a){if(!a.altKey&&!a.shiftKey&&!a.ctrlKey&&!a.metaKey){P.Ra(a);
ca.Ra(a);if(a.which==38||a.which==40||a.which==32){a.preventDefault();a.stopPropagation()}}});var Ae=[,,,"CANCEL",,,"HELP",,"BACK SPACE","TAB",,,"CLEAR","RETURN","ENTER",,"SHIFT","CTRL","ALT","PAUSE","CAPS LOCK",,,,,,,"ESCAPE",,,,,"SPACE","PAGE UP","PAGE DOWN","END","HOME","&larr;","&uarr;","&rarr;","&darr;",,,,"PRINT SCREEN","INSERT","DELETE",,"0","1","2","3","4","5","6","7","8","9",,";",,"=",,,,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z",
"META",,"CONTEXT MENU",,,"NUMPAD0","NUMPAD1","NUMPAD2","NUMPAD3","NUMPAD4","NUMPAD5","NUMPAD6","NUMPAD7","NUMPAD8","NUMPAD9","*","+","SEPARATOR","-","DECIMAL","DIVIDE","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24",,,,,,,,,"NUM LOCK","SCROLL LOCK",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,";","=",",","-",".","/",'"',,,,,,,,,,,,,,,,,,,,,,,,,,,"[","\\","]","'",,"META"];z.prototype.K=function(a){if(this.parent!==o)if(this.parent.firstChild==
this)this.parent.firstChild=this.nextSibling;else for(var b=this.parent.firstChild;b!==o;b=b.nextSibling)if(b.nextSibling==this)b.nextSibling=this.nextSibling;this.nextSibling=o;this.parent=a;if(this.parent!==o){this.nextSibling=this.parent.firstChild;this.parent.firstChild=this}};z.prototype.e=function(a){a.save();a.translate(this.n.x,this.n.y);this.bb&&a.scale(-1,1);a.rotate(this.k);a.translate(this.nb.x,this.nb.y);this.p(a);for(var b=this.firstChild;b!==o;b=b.nextSibling)b.e(a);a.restore()};var ob=
{ua:{killKey:75,"a-jumpKey":38,"a-crouchKey":40,"a-leftKey":37,"a-rightKey":39,"b-jumpKey":87,"b-crouchKey":83,"b-leftKey":65,"b-rightKey":68},Oc:function(a){for(var b in this.ua)if(a==this.ua[b])return b;return o},oe:function(a){a=de(Ae[a]||"&iquest;").replace(" ","<br>");if(a.charAt(0)!="&"&&a.length>1)a='<div style="'+(a.indexOf("<br>")!=-1?"padding-top:10px;line-height:15px;":"")+"font-size:"+(a.length<=3?25:a.length<=5?18:15).toFixed()+'px;">'+a+"</div>";return a},load:function(){for(var a in this.ua){var b=
parseInt,c;a:{c=a;if(typeof localStorage!="undefined")c=localStorage.hasOwnProperty(c)?localStorage[c]:"";else{for(var d=document.cookie.split(";"),e=0;e<d.length;e++){var f=d[e],h=f.indexOf("=");if(h!=-1&&f.substring(0,h).replace(/ /g,"")==c){c=f.substring(h+1);break a}}c=""}}b=b(c,10);isNaN(b)||(this.ua[a]=b)}this.Hd()},save:function(){for(var a in this.ua){var b=a,c=this.ua[a];if(typeof localStorage!="undefined")localStorage[b]=c;else{var d=new Date;d.setTime(d.getTime()+15768E7);document.cookie=
b+"="+c+"; expires="+d.toGMTString()+"; path=/"}}this.Hd()},Hd:function(){for(var a in this.ua)$("#"+a).html(this.oe(this.ua[a]))}};g.prototype.add=function(a){return new g(this.x+a.x,this.y+a.y)};g.prototype.eq=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)<0.001};g.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};g.prototype.bb=function(){return new g(this.y,-this.x)};g.prototype.atan2=function(){return Math.atan2(this.y,this.x)};g.prototype.rotate=function(a){var b=
Math.sin(a);a=Math.cos(a);return new g(this.x*a-this.y*b,this.x*b+this.y*a)};g.prototype.ob=function(a){var b,c;return b=this.x*a.x+this.y*a.y,c=new g(0,0),c.x=a.x*b,c.y=a.y*b,c};g.prototype.toString=function(){return"("+this.x.toFixed(3)+", "+this.y.toFixed(3)+")"};g.prototype.uc=function(a,b){var c,d,e,f,h,i,j,k=(c=(d=new g(0,0),d.x=a.x-this.x,d.y=a.y-this.y,d),c.x*c.x+c.y*c.y)<b*b?a:(c=(e=(f=(j=new g(0,0),j.x=a.x-this.x,j.y=a.y-this.y,j),h=new g(0,0),i=Math.sqrt(f.x*f.x+f.y*f.y),h.x=f.x/i,h.y=
f.y/i,h),e.x*=b,e.y*=b,e),d=new g(0,0),d.x=this.x+c.x,d.y=this.y+c.y,d);this.x=k.x;this.y=k.y};g.G=function(a){return new g(Math.cos(a),Math.sin(a))};g.Ua=function(a,b,c){var d,e,f,h;return d=(f=(h=new g(0,0),h.x=b.x-a.x,h.y=b.y-a.y,h),f.x*=c,f.y*=c,f),e=new g(0,0),e.x=a.x+d.x,e.y=a.y+d.y,e};x.prototype.add=function(){for(var a=0;a<arguments.length;a++)this.xa.push(arguments[a]*Math.PI/180);return this};x.prototype.jb=function(a,b){for(var c,d,e=new x((c=this.f.x,d=a.f.x,c+(d-c)*b),(c=this.f.y,d=
a.f.y,c+(d-c)*b)),f=0;f<this.xa.length;f++)e.xa.push((c=this.xa[f],d=a.xa[f],c+(d-c)*b));return e};x.Ua=function(a,b){var c=Math.floor(b);b-=c;c%=a.length;return a[c].jb(a[(c+1)%a.length],b)};var Be=[(new x(0,-0.1)).add(5,-10,65,-55,20,40,-20,-30,-30,10),(new x(0,-0.04)).add(5,-10,35,-25,0,30,18,-110,0,20),(new x(0,0)).add(5,-10,10,-30,-20,20,60,-100,10,30),(new x(0,-0.1)).add(5,-10,-20,-30,-30,10,65,-55,20,40),(new x(0,-0.04)).add(5,-10,18,-110,0,20,35,-25,0,30),(new x(0,0)).add(5,-10,60,-100,10,
30,10,-30,-20,20)],Tc=[(new x(0,0)).add(0,-10,150,-170,-40,30,-30,-20,20,150),(new x(0,0)).add(-20,10,60,-100,-80,30,30,-20,30,30)],Uc=(new x(0.1,0)).add(0,-10,150,-130,140,50,50,-30,50,130),Ce=(new x(0,-0.2)).add(30,-30,130,-110,-30,40,60,-120,20,20),De=[(new x(0,0)).add(-20,5,10,-30,-120,-30,40,-20,120,30),(new x(0,0)).add(-20,5,10,-30,-130,-60,40,-20,150,50)],Vc=[(new x(0.1,0)).add(0,-10,150,-130,140,50,50,-30,50,130),(new x(0,-0.2)).add(30,-30,160,-180,-30,40,20,-10,20,20)],bc=0,fa=1,cc=2,ec=
3,Bb=4,gc=5,dc=6,fc=7,Cb=8,hc=9,fe=10;J.t(G);J.prototype.reset=function(a,b){this.rightKey=this.leftKey=this.crouchKey=this.jumpKey=p;this.Aa=new F(a,new g(0.1,0.375),new g(-0.1,0.375),new g(0,-0.375));this.b=new g(0,0);this.W=new g(0,0);this.oa=this.ha=this.aa=0;this.dc=this.pd=p;this.da=o;this.wd=this.z=0;this.d=ee();this.ja=p;this.sb=this.ab=this.Lc=this.Ad=0;this.ud=new g(0,0);this.Lb=this.Jb=0;this.ya=p;this.color=b};J.prototype.u=L("Aa");J.prototype.db=L("color");J.prototype.je=function(){return this==
n.r};J.prototype.Yd=function(){this.dc=l};J.prototype.Kd=function(a){var b;b=this.b;b.x+=a.x;b.y+=a.y};J.prototype.Sd=function(){var a,b,c,d,e=n.Ab(this);if(e.crouchKey&&!e.l&&this.z==0&&e.z==0){if((a=e.b,a.x*a.x+a.y*a.y)<0.01&&Math.abs(this.b.x)>4){var f=(a=this.a(),b=e.a(),c=new g(0,0),c.x=a.x-b.x,c.y=a.y-b.y,c);if(Math.abs(f.y)<=0.01&&Math.abs(f.x)<0.1){this.b=new g(0,10);this.ya=l}}if((a=(b=this.a(),c=e.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d),a.x*a.x+a.y*a.y)<1&&this.ab>1&&e.ab>=this.ab)n.Ge(e.a())}};
J.prototype.B=function(a){this.Ne(a);if(!this.l){this.Pe(a);this.Oe(a);this.Me(a)}};J.prototype.Ne=function(a){if(this.l)this.sb+=a;else this.sb=0;this.sb>3.3&&!n.Ab(this).l&&this.w(p);if(this.l){a=n.j.na;var b=(this.sb-2)/1;b=Math.max(0,Math.min(1,b));b=0.5-0.5*Math.cos(b*Math.PI);b=0.5-0.5*Math.cos(b*Math.PI);this.Cd(g.Ua(this.ud,a,b))}};J.prototype.Pe=function(a){var b,c,d,e;if(this.da!=o)this.ha=this.oa=0;this.ha-=a;if(this.ha<0)this.oa*=Math.pow(0.1,a);if(this.da!=o||this.b.y<0)this.ya=p;var f=
this.leftKey&&!this.rightKey&&!this.crouchKey,h=this.rightKey&&!this.leftKey&&!this.crouchKey;r.qd(this,W,n.j);var i=W.s[ia]!=o||this.da!=o&&B.qa(this.da.q)==ia,j=W.s[Kb]!=o||this.da!=o&&B.qa(this.da.q)==Kb,k=W.s[Lb]!=o||this.da!=o&&B.qa(this.da.q)==Lb,m=W.s[pc]!=o||this.da!=o&&B.qa(this.da.q)==pc;if(!this.dc&&this.jumpKey)if(i){this.b.y=6.5;this.oa=this.aa=this.ha=0;if(j||k){this.ha=0.5;this.aa=1;this.oa=0.5}if(k)this.aa=-this.aa;if(n.Ab(this).ya){this.b.y=10;this.ya=l}}else if(j&&!f&&this.ha<0){this.b=
new g(3.5,6.5);this.ha=0.5;this.aa=2.5;this.oa=1}else if(k&&!h&&this.ha<0){this.b=new g(-3.5,6.5);this.ha=0.5;this.aa=-2.5;this.oa=1}if(m)this.oa=this.aa=this.ha=0;if(i||!m){if(f){this.b.x-=50*a;this.b.x=Math.max(this.b.x,-8)}if(h){this.b.x+=50*a;this.b.x=Math.min(this.b.x,8)}}this.z=W.s[ia]?0:W.s[Kb]?3:W.s[Lb]?4:1;f={};h={};i=r.$a(this,0.1,h,f,n.j);if(this.z==3||this.z==4){if(this.b.y<0)this.b.y*=Math.pow(0.1,a);if(this.b.y>-0.5&&this.wd===2)this.z=2}if(this.z==1&&i<0.01&&h.c.y>f.c.y)this.z=2;if(this.z==
2){if(this.leftKey&&f.c.x-this.Aa.a().x<0){this.b.x-=5*a;this.b.y+=10*a}if(this.rightKey&&f.c.x-this.Aa.a().x>0){this.b.x+=5*a;this.b.y+=10*a}}this.ab+=a;if(!this.crouchKey||this.z!=0)this.ab=0;if(this.z==0)if(this.crouchKey){b=this.b;c=Math.pow(1.0E-6,a);b.x*=c;b.y*=c}else{this.b.y-=10*a;if(!this.jumpKey&&this.leftKey!=this.rightKey&&this.pd&&W.s[ia].C.q.y<0.99){this.b=(b=this.b.ob((d=W.s[ia].C.q,e=new g(0,0),e.x=d.y,e.y=-d.x,e)),c=new g(0,0),c.x=b.x*0.99,c.y=b.y*0.99,c);this.b.y+=0.001}}else this.b.y-=
10*a;this.pd=this.z==0&&W.s[ia].C.q.y<0.99;this.Sd();this.W=g.Ua(this.b,new g(this.aa,this.b.y),this.oa);if(this.aa!=0&&this.b.x/this.aa>1)this.W.x=this.b.x;d=(b=this.W,c=new g(0,0),c.x=b.x*a,c.y=b.y*a,c);this.b.x*=Math.pow(7.6E-5,a);c={c:d};a={c:this.b};b=r.Ub(this,c,a,0,n.j,l);d=c.c;this.b=a.c;this.da=b;this.Aa.moveBy(d);if(this.W.y<-15&&b!=o&&b.q.y>0.9){this.w(l);this.L()}this.wd=this.z;this.dc=p};J.prototype.L=function(){var a,b,c,d,e,f;this.b=new g(0,0);this.z=1;this.aa=this.oa=0;this.ya=p;this.sb=
0;this.ud=this.Aa.f;var h=n.i==this,i=h?1:0.1;h=h?0.1:1;for(var j=0;j<500;j++){var k=g.G((a=2*Math.PI,b=Math.random(),0+(a-0)*b));k=(a=this.b,b=(d=(f=Math.random(),1+9*f),e=new g(0,0),e.x=k.x*d,e.y=k.y*d,e),c=new g(0,0),c.x=a.x+b.x,c.y=a.y+b.y,c);A().Da().position(this.Aa.f).b(k).h(0.01,0.1).D(0,4).I(0.05,0.9).F(0.01,0.02).expand(1,1.2).color(i/2,0.05,h/2,1).V(i,0.1,h,1)}n.ra(Ee)};J.prototype.Oe=function(a){var b,c,d,e;if(this.z==3||this.z==4){var f=this.z==4?-1:1,h=this.Aa.T(),i=this.b.y;for(this.Jb-=
a*(b=this.b,Math.sqrt(b.x*b.x+b.y*b.y));this.Jb<0;){this.Jb+=0.2;var j=new g(this.z==4?h.eb():h.m.x,(b=h.m.y,c=h.gb()+0.25,d=Math.random(),b+(c-b)*d)),k=new g((b=Math.random(),0+(f-0)*b),(b=2*i,c=Math.random(),i+(b-i)*c));A().color(0.3,0.3,0.3,1).V(0.5,0.3,0.3,1).position(j).pa().h(0.02,0.04).F(0.01,0.2).ka(15).D(2,4).b(k).I(0.05,0.1)}}else this.Jb=0;if(this.ya)for(this.Lb-=a;this.Lb<0;){this.Lb+=0.025;j=(b=this.Aa.f,c=new g((e=-0.2,e+(0.2-e)*Math.random()),(e=-0.4,e+(0.4-e)*Math.random())),d=new g(0,
0),d.x=b.x+c.x,d.y=b.y+c.y,d);A().color(1,1,0,1).V(1,1,0,0.75).position(j).pa().h(0.03,0.05).expand(1.1,1.2).F(0.1,0.2).ka(5).D(2,3)}else this.Lb=0};J.prototype.Me=function(a){var b,c,d=1;this.Ad+=a*Math.abs(this.W.x)*Math.PI;this.Lc+=8*a;if(this.z==3){this.ja=p;a=Uc}else if(this.z==4){this.ja=l;a=Uc}else if(this.z==1){if(this.W.x<0)this.ja=p;else if(this.W.x>0)this.ja=l;if(this.W.y>-15){a=this.W.y/4;a=a<0?1/(1-a)-1:1-1/(1+a);a=0.5-0.5*a;a=Tc[0].jb(Tc[1],a)}else a=x.Ua(De,this.Lc)}else if(this.z==
2){var e={},f={};r.$a(this,2,e,f,n.j);a=(this.a().y-f.c.y)/0.75;a+=0.5;a=Vc[0].jb(Vc[1],a);this.ja=e.c.x<f.c.x}else if(this.crouchKey)a=Ce;else{a=x.Ua(Be,this.Ad);if(this.W.x<-0.1)this.ja=p;else if(this.W.x>0.1)this.ja=l;d=Math.abs(this.W.x)/5;if(d>1)d=1}for(e=0;e<this.d.length;e++)this.d[e].k=a.xa[e]*d;d=(b=a.f,c=new g(0,0),c.x=b.x*d,c.y=b.y*d,c);this.d[fa].n=new g(this.a().x+d.x*(this.ja?-1:1),this.a().y+d.y);this.d[fa].bb=!this.ja};J.prototype.e=function(a){if(!this.l){if(this.ya){a.strokeStyle=
"rgba(255, 255, 0, "+Math.max(0,this.b.y/10).toFixed(3)+")";a.lineWidth*=3;this.d[fa].e(a);a.lineWidth/=3}a.fillStyle=this.je()==0?"red":"blue";a.strokeStyle="black";this.d[fa].e(a)}};var Jc=0.3,gb=0,Db=1,he=2,ie=3,je=4,ic=5,Kc=9,Fe=(new x(0,0.1)).add(0,-80,-80,80,80,100,100,-100,-100),Wc=[(new x(0,0.2)).add(0,-40,-30,30,40,40,40,-40,-40),(new x(0,0.1)).add(0,-80,-80,80,80,100,100,-100,-100)],Eb=0.4,Lc=0.5,le=0.5;Ga.t(ba);Ga.prototype.move=function(a){if(this.mc<=0){this.b.y=2.5+4*Math.random();this.b.x=
Math.random()>0.5?6.5-this.b.y:-6.5+this.b.y;this.mc=Lc;this.gc=p}else if(this.gc)this.mc-=a;return this.fa(new g(0,-6),a)};Ga.prototype.ea=function(a){if(a.q.y>=0.999){this.b.x=0;this.b.y=0;this.gc=l}};Ga.prototype.H=function(){var a,b,c,d,e=this.a();this.d[gb].n=e;var f={},h={};if(r.$a(this,2*Eb,f,h,n.j)<3*Eb&&f.c.eq((a=new g(0,-Eb),b=new g(0,0),b.x=e.x+a.x,b.y=e.y+a.y,b))&&(a=(b=h.c,c=f.c,d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d),Math.sqrt(a.x*a.x+a.y*a.y))<0.1)a=Fe;else{a=this.b.y*-0.25;a=a<0?1/
(1-a)-1:1-1/(1+a);a=Wc[0].jb(Wc[1],a)}this.d[gb].nb=a.f;for(b=0;b<Kc;b++)this.d[b].k=a.xa[b]};Ga.prototype.e=function(a){this.d[gb].e(a)};Ga.prototype.Pa=N(l);var Nc=0.5,Fb=0,jc=1,qe=2,re=3,se=4,te=5,ue=6,ve=7,Pc=8,kc=9,Qc=16,Oc=17,Ge=[(new x).add(0,-10,-20,-10,10,-10,10,-10,-20,20,10,70,20,70,20,20,10),(new x).add(0,10,-10,-20,-10,-20,-10,10,-10,20,20,10,70,10,70,20,20),(new x).add(0,-10,10,-10,-20,-10,-20,-10,10,70,20,20,10,20,10,70,20),(new x).add(0,-20,-10,10,-10,10,-10,-20,-10,10,70,20,20,20,
20,10,70)],Xc=[(new x).add(0,7,3,-1,-5,5,1,-3,-7,-14,-6,2,10,-10,-2,6,14),(new x).add(0,30,10,-30,-20,30,40,-10,-35,-50,-90,40,20,-50,-40,70,30)],ea=0.9,hb=0.3,pe=2,yb=1,oe=1;da.t(H);da.prototype.ba=N(p);da.prototype.Xa=function(a){var b,c,d;if(a.l)return p;var e=(b=a.a(),c=this.a(),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d);b=e.atan2();if(e.y<10&&b>Math.PI*0.25&&b<Math.PI*0.75)return!r.Ia(this.a(),a.a(),n.j);return p};da.prototype.Ya=function(a,b,c){n.Ea(new aa(a,b,c),this.a())};da.prototype.Oa=function(){var a=
this.a();this.ib=new g(a.x-ea*0.4,a.y+hb*0.4);this.pb=new g(a.x+ea*0.4,a.y+hb*0.4);if(this.Xa(n.i)){if(this.Xa(n.r)){this.Ya(this.Sa?this.ib:this.pb,n.i,this.Sa?Math.PI*0.75:Math.PI*0.25);this.Ya(this.Sa?this.pb:this.ib,n.r,this.Sa?Math.PI*0.25:Math.PI*0.75);this.Sa=!this.Sa}else{this.Ya(this.ib,n.i,Math.PI*0.75);this.Ya(this.pb,n.i,Math.PI*0.25)}return l}else if(this.Xa(n.r)){this.Ya(this.ib,n.r,Math.PI*0.75);this.Ya(this.pb,n.r,Math.PI*0.25);return l}return p};da.prototype.move=function(){var a,
b,c,d,e;return a=(c=this.Ta.a(),d=this.a(),e=new g(0,0),e.x=c.x-d.x,e.y=c.y-d.y,e),b=new g(0,0.81-Yb+hb*0.5),a.x+=b.x,a.y+=b.y,a};da.prototype.H=function(a){var b=this.a();this.d[Fb].n=b;this.d[Fb].bb=this.Ta.b.x>0;b=this.Ta.Bb();if(b!=this.Qb){if(++this.Pb>1){this.Qb=b;this.Pb=0}}else this.Pb=0;this.$+=a*0.5;if(this.Qb)a=x.Ua(Ge,10*this.$);else{a=this.Ta.b.y*-0.25;a=a<0.01?0:1-1/(1+a);a=Xc[0].jb(Xc[1],a)}for(b=0;b<Oc;b++)this.d[b].k=a.xa[b]};da.prototype.Z=function(a){a.w(l)};da.prototype.L=function(){var a,
b;A().position(this.a()).D(1).ka(5).F(0.1).Wd(Mc).color(0,0,0,1).k(0).ga((a=-Math.PI,b=Math.PI,a+(b-a)*Math.random()))};da.prototype.e=function(a){a.strokeStyle="black";a.fillStyle="black";this.d[Fb].e(a)};var ib=0,R=1;Q.prototype.Ac=function(){return this.type===R||this.type===4||this.type===5};Q.prototype.Nc=function(){return this.type===R||this.type===2||this.type===3};Q.prototype.hd=function(){return this.type===R||this.type===2||this.type===4};Q.prototype.zd=function(){return this.type===R||
this.type===3||this.type===5};Q.prototype.Be=function(){return this.type===R||this.type===3||this.type===4};Q.prototype.ue=function(){return this.type===R||this.type===2||this.type===5};Q.prototype.Jd=function(a){this.s.push(a)};Q.prototype.Ce=function(a){this.s.splice(this.Pc(a),1)};Q.prototype.ee=function(a){for(var b=[],c=0;c<this.s.length;c++)this.s[c].Nd(a)&&b.push(this.s[c]);return b};Q.prototype.Pc=function(a){for(var b,c,d,e,f=0;f<this.s.length;++f){var h=this.s[f];if((b=(c=h.C.start,d=a.C.start,
e=new g(0,0),e.x=c.x-d.x,e.y=c.y-d.y,e),b.x*b.x+b.y*b.y)<0.001&&(b=(c=h.C.end,d=a.C.end,e=new g(0,0),e.x=c.x-d.x,e.y=c.y-d.y,e),b.x*b.x+b.y*b.y)<0.001)return f}return-1};Q.prototype.u=function(){var a=new g(this.x,this.y),b=new g(0,0),c=new g(0,1),d=new g(1,0),e=new g(1,1);switch(this.type){case R:return new F(a,b,d,e,c);case 2:return new F(a,b,d,c);case 3:return new F(a,b,d,e);case 4:return new F(a,b,e,c);case 5:return new F(a,c,d,e)}return o};Q.prototype.e=function(a){var b=this.x,c=this.y;a.beginPath();
if(this.type==R){a.moveTo(b,c);a.lineTo(b,c+1);a.lineTo(b+1,c+1);a.lineTo(b+1,c)}else if(this.type==2){a.moveTo(b,c);a.lineTo(b+1,c);a.lineTo(b,c+1)}else if(this.type==3){a.moveTo(b,c);a.lineTo(b+1,c+1);a.lineTo(b+1,c)}else if(this.type==4){a.moveTo(b,c);a.lineTo(b,c+1);a.lineTo(b+1,c+1)}else if(this.type==5){a.moveTo(b+1,c);a.lineTo(b,c+1);a.lineTo(b+1,c+1)}a.closePath();a.fill();a.stroke()};Q.prototype.be=function(a){for(var b=0;b<this.s.length;b++)this.s[b].e(a)};Ha.prototype.Vb=function(a){if(this.s[a]===
o)return p;var b=this.cells[a];return b!==o&&b.Pc(this.s[a])!==-1};Ha.prototype.Ic=function(a,b){if(this.s[a]!==o&&!this.Vb(a)){var c=this.cells[a];if(c!==o){c.Jd(new B(this.s[a].C.start,this.s[a].C.end,this.s[a].color));b&&n.pe(this.s[a]);n.xd()}}};Ha.prototype.Jc=function(a){if(this.s[a]!==o&&this.Vb(a)){var b=this.cells[a];if(b!==o){b.Ce(this.s[a]);n.xd()}}};Ha.prototype.sc=function(a,b,c){for(b=0;b<2;++b)switch(a){case 0:this.Jc(b);break;case 1:this.Ic(b,c);break;case 2:this.Vb(b)?this.Jc(b):
this.Ic(b,c)}};var ia=0,Kb=1,Lb=2,pc=3,Ta=1,Ua=2,Hb=4;B.prototype.Nd=function(a){switch(this.color){case 0:return l;case Ta:return a!=Ta;case Ua:return a!=Ua;case 3:return a!=Ta&&a!=Ua;case Hb:return a!=Hb}return p};B.prototype.qa=function(){return B.qa(this.C.q)};B.qa=function(a){if(a.x>0.9)return Kb;if(a.x<-0.9)return Lb;if(a.y<0)return pc;return ia};B.prototype.e=function(a){var b,c,d,e,f;switch(this.color){case 0:a.strokeStyle="black";break;case Ta:a.strokeStyle="#C00000";break;case Ua:a.strokeStyle=
"#0000D2"}this.C.e(a);var h=this.C.q.x*0.1,i=this.C.q.y*0.1;a.beginPath();for(var j=1;j<9;++j){var k=j/9;k=(b=(d=this.C.start,e=new g(0,0),e.x=d.x*k,e.y=d.y*k,e),c=(d=this.C.end,e=1-k,f=new g(0,0),f.x=d.x*e,f.y=d.y*e,f),b.x+=c.x,b.y+=c.y,b);a.moveTo(k.x,k.y);a.lineTo(k.x-h,k.y-i)}a.stroke()};var lc=0,nb=1,Ib=2,Ee=0,Va=1,nc=2,Pb=3,n,jb=0,kb=0,lb=0,mb=0;O.prototype.xd=function(){this.Wa++};O.prototype.Zb=function(a){return a==0?this.i:this.r};O.prototype.Ab=function(a){return a==this.i?this.r:this.i};
O.prototype.Ge=function(a){this.j.na=new g(a.x,a.y);this.Ed.y=0.125;this.j.na.y+=0.01};O.prototype.de=function(){var a=this.j.Sc,b=!this.i.l&&Math.abs(this.i.a().x-a.x)<0.4&&Math.abs(this.i.a().y-a.y)<0.4;a=!this.r.l&&Math.abs(this.r.a().x-a.x)<0.4&&Math.abs(this.r.a().y-a.y)<0.4;return b&&a};O.prototype.ce=function(){return this.i.l&&this.r.l};O.prototype.ra=function(a){++this.O[a]};O.prototype.Ea=function(a,b){var c,d;if(typeof b==="undefined")b=a.u().a();else a.u().moveTo(b);var e={c:(c=a.u().a(),
d=new g(0,0),d.x=c.x-b.x,d.y=c.y-b.y,d)};c={c:a.b};r.Ub(a,e,c,a.I,this.j,l);a.ma(c.c);a.u().moveBy(e.c);this.S.push(a)};O.prototype.tc=function(a,b,c,d,e){var f,h,i=l;if(a.y+1==b.y&&a.x==b.x){f=this.j.Y(a.x,a.y);h=this.j.Y(a.x-1,a.y);if(!f||!h||f.hd()||h.zd())i=p}else if(a.y-1==b.y&&a.x==b.x){f=this.j.Y(a.x-1,b.y);h=this.j.Y(a.x,b.y);if(!f||!h||f.zd()||h.hd())i=p}else if(a.x+1==b.x&&a.y==b.y){f=this.j.Y(a.x,a.y-1);h=this.j.Y(a.x,a.y);if(!f||!h||f.Ac()||h.Nc())i=p}else if(a.x-1==b.x&&a.y==b.y){f=this.j.Y(b.x,
a.y);h=this.j.Y(b.x,a.y-1);if(!f||!h||f.Nc()||h.Ac())i=p}else{h=a.x<b.x?a.x:b.x;var j=a.y<b.y?a.y:b.y;f=this.j.Y(h,j);h=this.j.Y(h,j);if(a.x<b.x===a.y<b.y){if(!f||f.Be())i=p}else if(!f||f.ue())i=p}a=i?c===0?new Ha(new B(a,b,d),o,f,o):new Ha(new B(a,b,d),new B(b,a,d),f,h):new Ha(o,o,o,o);this.Ga.push(a);e||a.sc(1,l,p)};O.prototype.ge=function(a){return this.Ga[a]};O.prototype.pe=function(a){for(var b=0;b<2;++b)r.Yc(this.Zb(b),a.C)&&this.Zb(b).w(l);for(b=0;b<this.S.length;++b){var c=this.S[b];c.ba()&&
r.Yc(c,a.C)&&c.w(l)}};O.prototype.B=function(a){var b,c,d;if(this.ca===nb||this.de())this.ca=nb;else if(this.ca===Ib||this.ce())this.ca=Ib;this.$+=a;if(this.killKey){this.i.w(l);this.r.w(l)}this.i.B(a);this.r.B(a);for(var e=0;e<this.S.length;++e)this.S[e].B(a);for(e=0;e<this.S.length;++e)this.S[e].l&&this.S.splice(e,1);this.lc-=a;if(this.lc<=0){a=(b=this.j.na,c=new g(0,0.25),d=new g(0,0),d.x=b.x-c.x,d.y=b.y-c.y,d);A().position(a).b(new g((b=-0.3,b+(0.3-b)*Math.random()),0.3)).h(0.03,0.05).D(0).F(0.1,
0.2).color(1,1,1,1).pa().ka(-5);this.lc+=0.3}};O.prototype.e=function(a,b,c,d,e){var f,h,i;jb=b-2;kb=c-2;lb=d+2;mb=e+2;b=(f=this.j.na,h=this.Ed,i=new g(0,0),i.x=f.x+h.x,i.y=f.y+h.y,i);f=this.j.Sc;if(b.x>=jb&&b.y>=kb&&b.x<=lb&&b.y<=mb){a.strokeStyle=a.fillStyle="rgba(255, 255, 255, 0.1)";a.beginPath();a.arc(b.x,b.y,1,0,2*Math.PI,p);a.stroke();a.fill();h=a.createLinearGradient(0,b.y-0.4,0,b.y+0.6);h.addColorStop(0,"rgba(255, 255, 255, 0.75)");h.addColorStop(1,"rgba(255, 255, 255, 0)");a.fillStyle=h;
a.beginPath();a.lineTo(b.x-0.35,b.y+0.6);a.lineTo(b.x-0.1,b.y-0.4);a.lineTo(b.x+0.1,b.y-0.4);a.lineTo(b.x+0.35,b.y+0.6);a.fill();a.fillStyle="black";a.beginPath();a.moveTo(b.x-0.1,b.y-0.45);a.lineTo(b.x-0.1,b.y-0.4);a.lineTo(b.x+0.1,b.y-0.4);a.lineTo(b.x+0.1,b.y-0.45);a.arc(b.x,b.y-0.45,0.2,0,Math.PI,l);a.fill()}if(f.x>=jb&&f.y>=kb&&f.x<=lb&&f.y<=mb){h=this.$;h=h-Math.floor(h);h=1-h;h=(h-Math.pow(h,6))*1.72;h=1-h;a.fillStyle="black";for(i=0;i<4;++i){c=i*(2*Math.PI/4);b=Math.sin(c);c=Math.cos(c);d=
0.45-h*0.25;a.beginPath();a.moveTo(f.x+c*d-b*0.15,f.y+b*d+c*0.15);a.lineTo(f.x+c*d+b*0.15,f.y+b*d-c*0.15);a.lineTo(f.x+c*(d-0.15),f.y+b*(d-0.15));a.fill()}}this.i.e(a);this.r.e(a);for(f=0;f<this.S.length;++f){h=this.S[f];i=h.a();i.x>=jb&&i.y>=kb&&i.x<=lb&&i.y<=mb&&h.e(a)}};O.prototype.qe=function(a){this.O=[0,0,0,0];this.j=new T(a.width,a.height,ua(a.start),ua(a.end));for(var b=0;b<a.width;b++)for(var c=0;c<a.height;c++){var d=a.cells[c][b];this.j.Fe(b,c,d);if(d!==R)this.j.Bd=new g(b+0.5,c+0.5)}this.j.Ud();
this.i.reset(this.j.na,Ta);this.r.reset(this.j.na,Ua);for(b=0;b<a.entities.length;++b){c=a.entities[b];switch(c["class"]){case "cog":this.S.push(new wa(ua(c.pos)));break;case "wall":n.tc(ua(c.end),ua(c.start),c.oneway?0:1,c.color,c.open);break;case "button":d=new na(ua(c.pos),c.type,l);d.Ga=c.walls;this.S.push(d);break;case "sign":this.S.push(new oa(ua(c.pos),c.text));break;case "enemy":this.S.push(we(c))}}};T.prototype.ae=function(a,b,c,d,e){b<0&&Gb(a,-100,0,100,this.height);c<0&&Gb(a,-100,-100,
this.width+200,100);d>this.width&&Gb(a,this.width,0,100,this.height);e>this.height&&Gb(a,-100,this.height,this.width+200,100)};T.prototype.e=function(a,b,c,d,e){a.fillStyle="#7F7F7F";a.strokeStyle="#7F7F7F";this.ae(a,b,c,d,e);b=Math.max(0,Math.floor(b));c=Math.max(0,Math.floor(c));d=Math.min(this.width,Math.ceil(d));e=Math.min(this.height,Math.ceil(e));for(var f=b;f<d;f++)for(var h=c;h<e;h++)this.cells[f][h].e(a);a.strokeStyle="black";for(f=b;f<d;f++)for(h=c;h<e;h++)this.cells[f][h].be(a)};T.prototype.Y=
function(a,b){return a>=0&&b>=0&&a<this.width&&b<this.height?this.cells[a][b]:o};T.prototype.cb=function(a,b){return a>=0&&b>=0&&a<this.width&&b<this.height?this.cells[a][b].type:R};T.prototype.Fe=function(a,b,c){this.cells[a][b]=new Q(a,b,c)};T.prototype.Ud=function(){for(var a=0;a<this.cells.length;a++)for(var b=0;b<this.cells[0].length;b++)this.cells[a][b].s=this.Vd(a,b)};T.prototype.Vd=function(a,b){var c=[],d=this.cb(a,b),e=this.cb(a-1,b),f=this.cb(a,b-1),h=this.cb(a+1,b),i=this.cb(a,b+1),j=
new g(a,b),k=new g(a+1,b),m=new g(a,b+1),q=new g(a+1,b+1);(d==ib||d==3||d==5)&&(e==R||e==3||e==5)&&c.push(new B(j,m,0));(d==ib||d==4||d==5)&&(f==R||f==4||f==5)&&c.push(new B(k,j,0));(d==ib||d==2||d==4)&&(h==R||h==2||h==4)&&c.push(new B(q,k,0));(d==ib||d==2||d==3)&&(i==R||i==2||i==3)&&c.push(new B(m,q,0));if(d==3)c.push(new B(q,j,0));else if(d==4)c.push(new B(j,q,0));else if(d==2)c.push(new B(k,m,0));else d==5&&c.push(new B(m,k,0));return c};T.prototype.zb=function(a,b){for(var c=Math.max(0,Math.floor(a.m.y)),
d=Math.min(this.width,Math.ceil(a.eb())),e=Math.min(this.height,Math.ceil(a.gb())),f=[],h=Math.max(0,Math.floor(a.m.x));h<d;h++)for(var i=c;i<e;i++)f=f.concat(this.cells[h][i].ee(b));return f};T.prototype.fe=function(a){var b=Math.max(0,Math.floor(a.m.y)),c=Math.min(this.width,Math.ceil(a.eb())),d=Math.min(this.height,Math.ceil(a.gb())),e=[];for(a=Math.max(0,Math.floor(a.m.x));a<c;a++)for(var f=b;f<d;f++)e=e.concat(this.cells[a][f]);return e};T.prototype.he=function(){return new v(new g(-60,-60),
new g(this.width+60,this.height+60))};T.prototype.$b=L("width");T.prototype.Qc=L("height")})();
